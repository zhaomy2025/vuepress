import{_ as s,c as a,d as t,o as p}from"./app-C07FBv5C.js";const e={};function c(l,n){return p(),a("div",null,n[0]||(n[0]=[t(`<h1 id="spring-boot-测试框架" tabindex="-1"><a class="header-anchor" href="#spring-boot-测试框架"><span>Spring Boot 测试框架</span></a></h1><p>Spring Boot 提供了强大的测试支持，帮助开发者编写高效、可靠的单元测试和集成测试。下面详细介绍 Spring Boot 单元测试中涉及的主要注解、类和接口。</p><h2 id="一、核心测试注解" tabindex="-1"><a class="header-anchor" href="#一、核心测试注解"><span>一、核心测试注解</span></a></h2><table><thead><tr><th>维度</th><th>说明</th><th>注解</th></tr></thead><tbody><tr><td>测试切片</td><td>仅加载特定层（如 Web、Data）的上下文，提升速度与专注度</td><td><code>@WebMvcTest</code>、 <code>@DataJpaTest</code>、 <code>@JdbcTest</code>、 <code>@JsonTest</code>、 <code>@RestClientTest</code></td></tr><tr><td>上下文控制</td><td>定制 Spring 应用上下文的加载范围与行为</td><td><code>@AutoConfigureTestDatabase</code>、 <code>@SpringBootTest</code>、 <code>@TestConfiguration</code></td></tr><tr><td>外部资源</td><td>管理测试所需的外部依赖（如数据库、消息队列）</td><td><code>@Testcontainers</code>、 <code>@Container</code>、 <code>@DynamicPropertySource</code></td></tr><tr><td>配置管理</td><td>覆盖或注入测试专用配置</td><td><code>@TestPropertySource</code>、 <code>@ActiveProfiles</code></td></tr><tr><td>生命周期与事务</td><td>控制测试执行流程与数据库事务行为</td><td><code>@BeforeEach</code>/<code>@AfterEach</code>、 <code>@Commit</code>/<code>@Rollback</code></td></tr><tr><td>HTTP 测试工具</td><td>模拟或真实调用 HTTP 接口</td><td><code>MockMvc</code>（模拟，用于 @WebMvcTest）、 <code>RestClient</code>（真实，用于 @SpringBootTest）</td></tr></tbody></table><blockquote><p><code>@Testcontainers</code>、<code>@Container</code> 不是 Spring 注解，而是 <code>org.testcontainers.junit.jupiter.Container</code> 优先使用 <code>MockMvc</code> 而非 <code>RestClient</code>，除非需要真实调用 HTTP 接口。 优先使用切片测试（如<code>@WebMvcTest</code>），仅在必要时使用 <code>@SpringBootTest</code>。</p></blockquote><h3 id="_1-类注解" tabindex="-1"><a class="header-anchor" href="#_1-类注解"><span>1. 类注解</span></a></h3><p>Spring Boot 测试中的类级别注解主要用于控制测试上下文的加载范围，按功能可分为完整上下文加载型（如 @SpringBootTest）、测试切片型（如 @WebMvcTest、@DataJpaTest 等）以及配置增强型（如 @TestConfiguration、@TestPropertySource）。其中，测试切片注解通过仅加载特定层所需组件，在保证测试准确性的同时显著提升执行效率。下表对比了各常用切片注解自动配置的核心组件：</p><table><thead><tr><th>注解</th><th>自动配置的主要组件</th></tr></thead><tbody><tr><td>@WebMvcTest</td><td>Controller、Converter、Filter、WebMvcConfigurer</td></tr><tr><td>@DataJpaTest</td><td>Repository、EntityManager、DataSource、TransactionManager</td></tr><tr><td>@JdbcTest</td><td>DataSource、JdbcTemplate、PlatformTransactionManager</td></tr><tr><td>@JsonTest</td><td>Jackson/Gson 相关组件、JsonComponent</td></tr><tr><td>@RestClientTest</td><td>RestTemplate、RestClient、MockRestServiceServer</td></tr></tbody></table><h4 id="springboottest" tabindex="-1"><a class="header-anchor" href="#springboottest"><span>@SpringBootTest</span></a></h4><ul><li>功能：加载完整的 Spring Boot 应用上下文，适合集成测试</li><li>特点： <ul><li>默认不启动Tomcat/Jetty 等真实服务器，但会加载完整的 Web 相关 Bean</li><li>若想完全禁用 Web 支持，应显式设置 webEnvironment = NONE</li></ul></li><li>参数：<code>webEnvironment</code> - 可选值包括 MOCK(默认)、RANDOM_PORT、DEFINED_PORT、NONE</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">MOCK</span><span class="token punctuation">)</span> <span class="token comment">// 默认值</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MockWebTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用模拟的 Servlet 环境，不启动真实服务器</span></span>
<span class="line">    <span class="token comment">// 但会加载 WebMVC 相关配置，可以使用 MockMvc</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">NoWebTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 完全不加载 Web 环境，适合纯业务逻辑测试</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">RANDOM_PORT</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RealServerTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 启动真实服务器在随机端口，适合端到端测试</span></span>
<span class="line">    <span class="token annotation punctuation">@LocalServerPort</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span> <span class="token comment">// 可以获取实际端口号</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="testconfiguration" tabindex="-1"><a class="header-anchor" href="#testconfiguration"><span>@TestConfiguration</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@TestConfiguration</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TestConfig</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">UserService</span> <span class="token function">testUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TestUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="webmvctest" tabindex="-1"><a class="header-anchor" href="#webmvctest"><span>@WebMvcTest</span></a></h4><ul><li>功能：仅加载 Controller 层的 Spring 上下文，适合控制器单元测试</li><li>特点： <ul><li>不会启动真正的 HTTP 服务器，通过 MockMvc 模拟 HTTP 请求</li><li>天然隔离业务逻辑，聚焦 Controller 行为验证。</li></ul></li><li>使用场景：测试控制器的路由、参数绑定、响应状态等</li><li>自动配置的组件： <ul><li>@Controller, @RestController, @ControllerAdvice</li><li>WebMvcConfigurer, Converter, Formatter</li><li>JsonComponent（用于 JSON 序列化）</li><li>Filter, HandlerInterceptor（部分）</li><li>自动注入 MockMvc</li></ul></li><li>不加载的组件： <ul><li>@Service, @Component, @Repository（除非用 @MockBean 显式模拟）</li><li>数据源、JPA、事务管理器</li><li>完整的 Spring Security 配置（需额外启用）</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// ✅ 明确指定被测 Controller</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span> <span class="token comment">// 自动配置</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@MockBean</span> <span class="token comment">// ✅ 模拟 Controller 依赖的 Service</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldReturnUserById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 1. 准备 Mock 行为</span></span>
<span class="line">        <span class="token class-name">User</span> mockUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>mockUser<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. 发送模拟请求</span></span>
<span class="line">        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 3. 验证 Service 调用</span></span>
<span class="line">        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldReturn404WhenUserNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 模拟抛出异常</span></span>
<span class="line">        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">999L</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/999&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;User not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="datajpatest" tabindex="-1"><a class="header-anchor" href="#datajpatest"><span>@DataJpaTest</span></a></h4><ul><li>功能：专门用于测试 JPA 数据访问层</li><li>特点：自动配置内存数据库，事务自动回滚</li><li>使用场景：测试 Repository 接口和数据库操作</li></ul><h4 id="jdbctest" tabindex="-1"><a class="header-anchor" href="#jdbctest"><span>@JdbcTest</span></a></h4><ul><li>功能： <ul><li>专门用于测试 JDBC 相关组件的测试切片注解。</li></ul></li><li>特点 <ul><li>仅自动配置数据源、JDBC Template 等 JDBC 相关组件</li><li>默认使用嵌入式数据库（H2）</li><li>自动配置 JdbcTestUtils</li><li>事务自动回滚</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@JdbcTest</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">JdbcTemplateTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testDatabaseConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testJdbcOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 插入测试数据</span></span>
<span class="line">        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users (name, email) VALUES (?, ?)&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">                           <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;john@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 查询验证</span></span>
<span class="line">        <span class="token class-name">Integer</span> count <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;SELECT COUNT(*) FROM users WHERE name = ?&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 使用 JdbcTestUtils</span></span>
<span class="line">        <span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token class-name">JdbcTestUtils</span><span class="token punctuation">.</span><span class="token function">countRowsInTable</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>rowCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token annotation punctuation">@Sql</span><span class="token punctuation">(</span><span class="token string">&quot;/test-data.sql&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 执行 SQL 脚本初始化数据</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testWithSqlScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;SELECT * FROM users&quot;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSize</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 假设 test-data.sql 插入了3条记录</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 测试特定数据源配置</span></span>
<span class="line"><span class="token annotation punctuation">@JdbcTest</span></span>
<span class="line"><span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ExternalDatabaseTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用外部配置的数据库而非嵌入式数据库</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jsontest" tabindex="-1"><a class="header-anchor" href="#jsontest"><span>@JsonTest</span></a></h4><ul><li>功能：测试 JSON 序列化和反序列化</li><li>特点： <ul><li>仅自动配置与 JSON 相关的组件（Jackson/Gson）</li><li>不加载完整的应用上下文，启动快速</li><li>还会自动配置 ObjectMapper、JacksonTester，并扫描 @JsonComponent、JsonSerializer、JsonDeserializer 等自定义组件。</li></ul></li><li>使用场景：测试 Controller 层返回的 JSON 数据是否符合预期</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@JsonTest</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">JsonSerializationTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">JacksonTester</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> json<span class="token punctuation">;</span>  <span class="token comment">// 自动配置 Jackson 测试器</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testSerialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;john@example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 验证序列化</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">isEqualToJson</span><span class="token punctuation">(</span><span class="token string">&quot;expected-user.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">hasJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.name&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">extractingJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.name&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testDeserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;{\\&quot;name\\&quot;:\\&quot;John\\&quot;,\\&quot;email\\&quot;:\\&quot;john@example.com\\&quot;,\\&quot;age\\&quot;:30}&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 验证反序列化</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;john@example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 支持 Gson 测试</span></span>
<span class="line"><span class="token annotation punctuation">@JsonTest</span></span>
<span class="line"><span class="token annotation punctuation">@GsonTest</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">GsonSerializationTest</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">GsonTester</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> gsonTester<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testGsonSerialization</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice@example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>gsonTester<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualToJson</span><span class="token punctuation">(</span><span class="token string">&quot;alice.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="restclienttest" tabindex="-1"><a class="header-anchor" href="#restclienttest"><span>@RestClientTest</span></a></h4><ul><li>功能：适用于测试使用 RestTemplate、RestClient 或 WebClient 的 客户端组件（如 Service 中封装的 HTTP 调用），而非 Controller。它会自动配置 MockRestServiceServer 来拦截请求。</li><li>特点 <ul><li>仅自动配置 REST 相关组件（RestTemplate, RestClient, WebClient）</li><li>模拟服务器响应，不进行真实网络调用</li><li>支持 MockRestServiceServer 自动配置</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@RestClientTest</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">// 指定要测试的 REST 客户端</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RestClientTestExample</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>  <span class="token comment">// 被测试的 REST 客户端</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">MockRestServiceServer</span> server<span class="token punctuation">;</span>  <span class="token comment">// 自动配置的模拟服务器</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testGetUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 模拟服务器响应</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">requestTo</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andRespond</span><span class="token punctuation">(</span><span class="token function">withSuccess</span><span class="token punctuation">(</span></span>
<span class="line">                  <span class="token string">&quot;{\\&quot;id\\&quot;:1,\\&quot;name\\&quot;:\\&quot;John\\&quot;}&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">                  <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span></span>
<span class="line">              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 执行测试</span></span>
<span class="line">        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 验证结果</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 验证请求是否按预期发送</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testPostUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">requestTo</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;{\\&quot;name\\&quot;:\\&quot;Alice\\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andRespond</span><span class="token punctuation">(</span><span class="token function">withCreatedEntity</span><span class="token punctuation">(</span><span class="token constant">URI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 测试 WebClient</span></span>
<span class="line"><span class="token annotation punctuation">@RestClientTest</span><span class="token punctuation">(</span><span class="token class-name">WebClientService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">WebClientTestExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">WebClientService</span> webClientService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">MockWebServiceServer</span> server<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testWebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">requestTo</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">.</span><span class="token function">andRespond</span><span class="token punctuation">(</span><span class="token function">withSuccess</span><span class="token punctuation">(</span><span class="token string">&quot;response&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> result <span class="token operator">=</span> webClientService<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="testcontainers" tabindex="-1"><a class="header-anchor" href="#testcontainers"><span>@Testcontainers</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">@Testcontainers</span>
<span class="line">@SpringBootTest</span>
<span class="line">class IntegrationTest {</span>
<span class="line">    @Container</span>
<span class="line">    static PostgreSQLContainer&lt;?&gt; postgres = new PostgreSQLContainer&lt;&gt;(&quot;postgres:13&quot;);</span>
<span class="line">    @DynamicPropertySource</span>
<span class="line">    static void configureProperties(DynamicPropertyRegistry registry) {</span>
<span class="line">        registry.add(&quot;spring.datasource.url&quot;, postgres::getJdbcUrl);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="extendwith" tabindex="-1"><a class="header-anchor" href="#extendwith"><span>@ExtendWith</span></a></h4><ul><li>功能：JUnit 5 中替代 <code>@RunWith</code> 的注解，用于扩展测试功能</li><li>常用扩展：<code>@ExtendWith(SpringExtension.class)</code> 用于集成 Spring 测试框架</li><li>用法：可单独使用或与其他测试注解组合使用</li></ul><h4 id="autoconfiguretestdatabase-可作用于类或方法" tabindex="-1"><a class="header-anchor" href="#autoconfiguretestdatabase-可作用于类或方法"><span>@AutoConfigureTestDatabase (可作用于类或方法)</span></a></h4><blockquote><p>注意：@AutoConfigureTestDatabase 虽常用于类上，但本质是配置修饰器，可作用于类或方法。</p></blockquote><ul><li>功能： <ul><li>控制测试中数据库的自动配置行为。</li></ul></li><li>主要参数 <ul><li>replace：替换策略 <ul><li>Replace.NONE：不替换，使用配置的数据源</li><li>Replace.ANY：总是替换为嵌入式数据库（默认）</li><li>Replace.AUTO_CONFIGURED：仅替换自动配置的数据源</li></ul></li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// 使用嵌入式数据库（默认行为）</span></span>
<span class="line"><span class="token annotation punctuation">@JdbcTest</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">EmbeddedDatabaseTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 自动使用 H2 嵌入式数据库</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用配置的数据库（不替换）</span></span>
<span class="line"><span class="token annotation punctuation">@DataJpaTest</span></span>
<span class="line"><span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ProductionDatabaseTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用 application.properties 中配置的数据源</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 与 Testcontainers 结合使用</span></span>
<span class="line"><span class="token annotation punctuation">@DataJpaTest</span></span>
<span class="line"><span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;spring.datasource.url=jdbc:tc:postgresql:13:///testdb&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">TestcontainersDatabaseTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用 Testcontainers 提供的 PostgreSQL</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 条件化数据库替换</span></span>
<span class="line"><span class="token annotation punctuation">@JdbcTest</span></span>
<span class="line"><span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span><span class="token constant">AUTO_CONFIGURED</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ConditionalDatabaseTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 仅替换自动配置的数据源，不替换手动配置的数据源</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-方法注解" tabindex="-1"><a class="header-anchor" href="#_2-方法注解"><span>2. 方法注解</span></a></h3><h4 id="test" tabindex="-1"><a class="header-anchor" href="#test"><span>@Test</span></a></h4><ul><li>功能：标记方法为测试方法，JUnit 测试运行器会执行被此注解标记的方法</li><li>位置：方法级别，只能用于无参数、无返回值的公共方法</li><li>JUnit 5 中的 @Test 不再支持 expected 和 timeout 参数</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">testUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 测试逻辑</span></span>
<span class="line">    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;expected&quot;</span><span class="token punctuation">,</span> actual<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sql" tabindex="-1"><a class="header-anchor" href="#sql"><span>@Sql</span></a></h4><ul><li>功能：在测试执行前后执行 SQL 脚本</li><li>用途：初始化测试数据或清理测试环境</li><li>参数：<code>scripts</code> - SQL 脚本路径，<code>executionPhase</code> - 执行阶段（BEFORE_TEST_METHOD/AFTER_TEST_METHOD）</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token annotation punctuation">@Sql</span><span class="token punctuation">(</span>scripts <span class="token operator">=</span> <span class="token string">&quot;/test-data.sql&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">testWithTestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用初始化的数据进行测试</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="beforeeach" tabindex="-1"><a class="header-anchor" href="#beforeeach"><span>@BeforeEach</span></a></h4><ul><li>功能：在每个测试方法执行前执行</li><li>用途：设置测试环境、初始化测试数据</li><li>位置：方法级别，方法必须是公共的、无参数、无返回值</li></ul><h4 id="aftereach" tabindex="-1"><a class="header-anchor" href="#aftereach"><span>@AfterEach</span></a></h4><ul><li>功能：在每个测试方法执行后执行</li><li>用途：清理测试资源、还原测试环境</li><li>位置：方法级别，方法必须是公共的、无参数、无返回值</li></ul><h4 id="beforeall-静态方法注解" tabindex="-1"><a class="header-anchor" href="#beforeall-静态方法注解"><span>@BeforeAll(静态方法注解)</span></a></h4><ul><li>功能：在所有测试方法执行前执行一次</li><li>用途：初始化共享资源</li><li>位置：静态方法级别，方法必须是公共的、无参数、无返回值</li></ul><h4 id="afterall-静态方法注解" tabindex="-1"><a class="header-anchor" href="#afterall-静态方法注解"><span>@AfterAll(静态方法注解)</span></a></h4><ul><li>功能：在所有测试方法执行后执行一次</li><li>用途：释放共享资源</li><li>位置：静态方法级别，方法必须是公共的、无参数、无返回值</li></ul><h4 id="commit" tabindex="-1"><a class="header-anchor" href="#commit"><span>@Commit</span></a></h4><ul><li>功能：提交测试事务，而不是默认的回滚</li><li>用途：当需要在测试后保留数据库更改时使用</li></ul><h4 id="rollback" tabindex="-1"><a class="header-anchor" href="#rollback"><span>@Rollback</span></a></h4><ul><li>功能：控制测试方法执行后的事务回滚行为</li><li>参数：boolean 值，默认为 true（回滚）</li></ul><h4 id="dynamicpropertysource-静态方法注解" tabindex="-1"><a class="header-anchor" href="#dynamicpropertysource-静态方法注解"><span>@DynamicPropertySource(静态方法注解)</span></a></h4><ul><li>功能：覆盖配置</li><li>@TestPropertySource 与 @DynamicPropertySource 优先级 <ul><li>两者都用于覆盖配置，但 @DynamicPropertySource 优先级更高（运行时动态注册）</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@DynamicPropertySource</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">configureProperties</span><span class="token punctuation">(</span><span class="token class-name">DynamicPropertyRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    registry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;app.database.url&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;jdbc:h2:mem:test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="testpropertysource" tabindex="-1"><a class="header-anchor" href="#testpropertysource"><span>@TestPropertySource</span></a></h4><ul><li>功能： <ul><li>为测试类提供特定的属性配置。</li></ul></li><li>特点 <ul><li>覆盖 application.properties 中的配置</li><li>支持 properties 文件和内联 properties</li><li>测试执行期间有效</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// 使用内联属性</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;spring.datasource.url=jdbc:h2:mem:testdb&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;server.port=8081&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;logging.level.org.springframework=DEBUG&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;app.feature.enabled=true&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">InlinePropertiesTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用覆盖后的属性配置</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用属性文件</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:test-config.properties&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">PropertiesFileTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用 test-config.properties 中的配置</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 组合使用</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span></span>
<span class="line">    locations <span class="token operator">=</span> <span class="token string">&quot;classpath:test-defaults.properties&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    properties <span class="token operator">=</span> <span class="token string">&quot;app.specific.setting=custom-value&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CombinedPropertiesTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 组合使用属性文件和内联属性</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 与 Profiles 结合使用</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;spring.profiles.active=test,integration&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MultiProfileTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 激活多个 profiles</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 数据库测试专用配置</span></span>
<span class="line"><span class="token annotation punctuation">@DataJpaTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;spring.jpa.hibernate.ddl-auto=create-drop&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;spring.jpa.show-sql=true&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;spring.datasource.url=jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DatabasePropertiesTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 为数据库测试专门配置的属性</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 测试特定业务配置</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;app.payment.gateway.url=https://sandbox.payment.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;app.payment.timeout=5000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;app.notification.enabled=false&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">BusinessConfigurationTest</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${app.payment.gateway.url}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> paymentUrl<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${app.payment.timeout}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> timeout<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>paymentUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;https://sandbox.payment.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-属性注解" tabindex="-1"><a class="header-anchor" href="#_3-属性注解"><span>3. 属性注解</span></a></h3><h4 id="mockbean" tabindex="-1"><a class="header-anchor" href="#mockbean"><span>@MockBean</span></a></h4><ul><li>功能：在 Spring 测试上下文中替换现有 Bean 为 Mockito Mock 对象</li><li>特点：会替换整个应用上下文中的对应 Bean</li><li>位置：类级别或属性级别</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@MockBean</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 测试方法</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="spybean" tabindex="-1"><a class="header-anchor" href="#spybean"><span>@SpyBean</span></a></h4><ul><li>功能：在 Spring 测试上下文中包装真实Bean，部分模拟 Spring Bean，保留原有行为</li><li>特点：可以监视真实 Bean 的方法调用，并在需要时进行模拟</li><li>位置：类级别或属性级别</li></ul><h4 id="autowired" tabindex="-1"><a class="header-anchor" href="#autowired"><span>@Autowired</span></a></h4><ul><li>功能：自动注入 Spring 容器中的 Bean</li><li>用途：在测试中获取需要测试或依赖的组件</li><li>位置：构造函数、方法、属性级别</li></ul><h4 id="value" tabindex="-1"><a class="header-anchor" href="#value"><span>@Value</span></a></h4><ul><li>功能：注入配置属性值</li><li>用途：在测试中获取配置文件中的属性值</li><li>位置：属性级别或方法参数级别</li></ul><h4 id="resource" tabindex="-1"><a class="header-anchor" href="#resource"><span>@Resource</span></a></h4><ul><li>功能：按名称或类型注入依赖项，是JSR-250标准注解</li><li>与@Autowired区别： <ul><li>默认优先按名称自动注入（字段名或指定 name），找不到回退到按类型</li><li>@Autowired默认按类型</li></ul></li><li>参数：<code>name</code> - 指定注入的bean名称，<code>type</code> - 指定注入的bean类型</li><li>位置：字段级别、方法级别或构造函数参数级别</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;userRepository&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepo<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 测试方法</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="container" tabindex="-1"><a class="header-anchor" href="#container"><span>@Container</span></a></h4><ul><li>功能：标记一个字段为 Testcontainers 容器实例，使其在测试生命周期中被自动管理（启动/停止）。</li><li>所属框架：Testcontainers（非 Spring Boot 原生注解，需额外依赖）。</li><li>特点： <ul><li>必须与 @Testcontainers 类注解配合使用；</li><li>字段可以是 static（类级别容器）或 非 static（每个测试方法独立容器，较少用）；</li><li>支持 Docker 容器（如 PostgreSQL、Redis、Kafka、Elasticsearch 等）；</li><li>自动处理容器的启动、等待就绪、网络配置、资源清理。</li></ul></li><li>适用场景： <ul><li>需要真实数据库/中间件进行集成测试；</li><li>替代 H2 嵌入式数据库以获得更接近生产环境的行为；</li><li>微服务依赖的外部服务模拟。</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@Testcontainers</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserServiceIntegrationTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Container</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token class-name">PostgreSQLContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> postgres <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostgreSQLContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;postgres:15&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withDatabaseName</span><span class="token punctuation">(</span><span class="token string">&quot;testdb&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withPassword</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@DynamicPropertySource</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">configureProperties</span><span class="token punctuation">(</span><span class="token class-name">DynamicPropertyRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 将容器的 JDBC URL 注入 Spring 环境</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.url&quot;</span><span class="token punctuation">,</span> postgres<span class="token operator">::</span><span class="token function">getJdbcUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.username&quot;</span><span class="token punctuation">,</span> postgres<span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.password&quot;</span><span class="token punctuation">,</span> postgres<span class="token operator">::</span><span class="token function">getPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldSaveUserToRealPostgreSQL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">User</span> saved <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>saved<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、关键工具类" tabindex="-1"><a class="header-anchor" href="#二、关键工具类"><span>二、关键工具类</span></a></h2><h3 id="restclient" tabindex="-1"><a class="header-anchor" href="#restclient"><span>RestClient</span></a></h3><ul><li>功能：向真实启动的 HTTP 服务发送请求。</li><li>特点： <ul><li>需要启动 web 容器（通常配合<code>@SpringBootTest(webEnvironment = RANDOM_PORT)</code>）</li></ul></li><li>适用场景： <ul><li>端到端的 HTTP 接口测试</li><li>微服务间调用的消费者侧测试</li><li>需要验证完整 HTTP 协议行为（Header、Status Code、Body）的场景</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">RANDOM_PORT</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserControllerIntegrationTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RestClient<span class="token punctuation">.</span>Builder</span> restClientBuilder<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RestClient</span> restClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@BeforeEach</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token annotation punctuation">@LocalServerPort</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 构建指向当前测试应用的 RestClient</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>restClient <span class="token operator">=</span> restClientBuilder</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:&quot;</span> <span class="token operator">+</span> port<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldReturnUserWhenExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 发送 GET 请求并解析为 User 对象</span></span>
<span class="line">        <span class="token class-name">User</span> response <span class="token operator">=</span> restClient</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/1&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldCreateNewUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">User</span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 发送 POST 请求</span></span>
<span class="line">        <span class="token class-name">User</span> created <span class="token operator">=</span> restClient</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>created<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertThat</span><span class="token punctuation">(</span>created<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;lisi@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">shouldHandleNotFoundGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 自定义 404 处理逻辑</span></span>
<span class="line">        <span class="token function">assertThatThrownBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span></span>
<span class="line">            restClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/999&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">onStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token operator">::</span><span class="token function">is4xxClientError</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UserNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found with ID 999&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">UserNotFoundException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webtestclient" tabindex="-1"><a class="header-anchor" href="#webtestclient"><span>WebTestClient</span></a></h3><ul><li>功能： <ul><li>主要用于测试 Spring WebFlux（响应式）应用 的端点</li><li>也可通过适配器间接测试 Spring MVC 应用，但需额外配置（非默认行为）</li></ul></li><li>特点： <ul><li>基于响应式栈（Reactive），支持异步测试；</li><li>提供流畅的 API，如 <code>get()</code>, <code>post()</code>, <code>put()</code>, <code>delete()</code> 等；</li><li>支持 JSON 路径断言（如 <code>jsonPath()</code>）；</li><li>可与 <code>@SpringBootTest</code> 配合使用，测试完整的请求处理流程。</li><li>支持多种绑定模式： <ul><li>绑定到真实服务器（端到端测试）；</li><li>绑定到单个控制器（bindToController()）；</li><li>绑定到路由函数（bindToRouterFunction()，仅 WebFlux）；</li><li>绑定到完整应用上下文（bindToApplicationContext()）。</li></ul></li></ul></li><li>与 Spring Boot 集成： <ul><li>在 WebFlux 项目中，可直接配合 @SpringBootTest + @AutoConfigureWebTestClient 使用；</li><li>在 MVC 项目中，若想使用 WebTestClient，必须显式启用 MockMvc 适配器（见下方示例）。</li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// Spring MVC 项目中使用 WebTestClient（需手动绑定 MockMvc）</span></span>
<span class="line"><span class="token comment">// ⚠️ 注意：此时底层仍是 MockMvc，WebTestClient 只是提供了一层更现代的 API 封装。</span></span>
<span class="line"><span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserControllerWebTestClientTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webTestClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@BeforeEach</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 通过 MockMvc 创建 WebTestClient</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>webTestClient <span class="token operator">=</span> <span class="token class-name">MockMvcWebTestClient</span><span class="token punctuation">.</span><span class="token function">bindTo</span><span class="token punctuation">(</span>mockMvc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testGetUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        webTestClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/users/1&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mockmvc" tabindex="-1"><a class="header-anchor" href="#mockmvc"><span>MockMvc</span></a></h3><ul><li>功能：模拟 HTTP 请求，测试 MVC 控制器</li><li>特点：无需启动实际服务器，快速测试控制器逻辑</li><li>主要方法：<code>perform()</code>, <code>andExpect()</code>, <code>andDo()</code>, <code>andReturn()</code></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@Autowired</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">    mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">           <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">           <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.length()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mockito-相关类" tabindex="-1"><a class="header-anchor" href="#mockito-相关类"><span>Mockito 相关类</span></a></h3><ul><li><code>Mockito</code>：核心工具类，提供 mock(), when(), verify() 等静态方法</li><li><code>ArgumentMatchers</code>：用于参数匹配，如 any(), eq() 等</li></ul><h2 id="三、测试层次与策略" tabindex="-1"><a class="header-anchor" href="#三、测试层次与策略"><span>三、测试层次与策略</span></a></h2><h3 id="_1-单元测试" tabindex="-1"><a class="header-anchor" href="#_1-单元测试"><span>1. 单元测试</span></a></h3><ul><li>测试单个组件，如 Service、Repository</li><li>使用 <code>@ExtendWith(MockitoExtension.class)</code></li><li>使用 Mockito 模拟依赖</li></ul><h3 id="_2-集成测试" tabindex="-1"><a class="header-anchor" href="#_2-集成测试"><span>2. 集成测试</span></a></h3><ul><li>测试多个组件协同工作</li><li>使用 <code>@SpringBootTest</code> 或特定的切片测试注解</li></ul><h3 id="_3-控制器测试" tabindex="-1"><a class="header-anchor" href="#_3-控制器测试"><span>3. 控制器测试</span></a></h3><ul><li>使用 <code>@WebMvcTest</code> + <code>MockMvc</code> 进行模拟测试</li><li>或使用 <code>@SpringBootTest</code> + <code>RestClient</code> 进行实际请求测试</li></ul><h3 id="_4-数据访问层测试" tabindex="-1"><a class="header-anchor" href="#_4-数据访问层测试"><span>4. 数据访问层测试</span></a></h3><ul><li>使用 <code>@DataJpaTest</code> 测试 Repository</li><li>或使用 <code>@SpringBootTest</code> + 测试数据库进行完整测试</li></ul><h2 id="四、测试配置与技巧" tabindex="-1"><a class="header-anchor" href="#四、测试配置与技巧"><span>四、测试配置与技巧</span></a></h2><h3 id="_1-测试配置文件" tabindex="-1"><a class="header-anchor" href="#_1-测试配置文件"><span>1. 测试配置文件</span></a></h3><ul><li>使用 <code>application-test.properties</code> 或 <code>application-test.yml</code></li><li>通过 <code>@ActiveProfiles(&quot;test&quot;)</code> 激活测试配置</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// 更现代的测试配置示例</span></span>
<span class="line"><span class="token annotation punctuation">@DataJpaTest</span></span>
<span class="line"><span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@TestPropertySource</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;spring.jpa.hibernate.ddl-auto=create-drop&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;spring.datasource.url=jdbc:tc:postgresql:13:///testdb&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ActiveProfiles</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RepositoryTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 测试代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-事务管理" tabindex="-1"><a class="header-anchor" href="#_2-事务管理"><span>2. 事务管理</span></a></h3><ul><li>测试方法默认在事务中执行，并在结束后回滚</li><li>可使用 <code>@Commit</code> 或 <code>@Rollback(false)</code> 提交事务</li></ul><h3 id="_3-测试生命周期" tabindex="-1"><a class="header-anchor" href="#_3-测试生命周期"><span>3. 测试生命周期</span></a></h3><ul><li><code>@BeforeEach</code>：每个测试方法执行前</li><li><code>@AfterEach</code>：每个测试方法执行后</li><li><code>@BeforeAll</code>：所有测试方法执行前（静态方法）</li><li><code>@AfterAll</code>：所有测试方法执行后（静态方法）</li></ul><h2 id="五、常用依赖" tabindex="-1"><a class="header-anchor" href="#五、常用依赖"><span>五、常用依赖</span></a></h2><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- JUnit 5 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- Spring Boot Test --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- spring-boot-starter-test 已包含 JUnit 5、Mockito、AssertJ 等，无需单独声明 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- 若需使用 RestClient, 需引入 spring-boot-starter-web --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- Mockito --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mockito<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mockito-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- 测试容器支持，按需引入 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testcontainers<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="六、完整的测试示例" tabindex="-1"><a class="header-anchor" href="#六、完整的测试示例"><span>六、完整的测试示例</span></a></h2><h3 id="controller-测试" tabindex="-1"><a class="header-anchor" href="#controller-测试"><span>Controller 测试</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@MockBean</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">testGetUserById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 准备模拟数据</span></span>
<span class="line">        <span class="token class-name">User</span> mockUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>mockUser<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 执行测试</span></span>
<span class="line">        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users/1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;$.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 验证方法调用</span></span>
<span class="line">        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过合理使用这些注解、类和接口，可以构建全面的测试套件，确保 Spring Boot 应用的质量和可靠性。</p><h3 id="集成测试" tabindex="-1"><a class="header-anchor" href="#集成测试"><span>集成测试</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">@Testcontainers</span>
<span class="line">@SpringBootTest</span>
<span class="line">class IntegrationTest {</span>
<span class="line">    @Container</span>
<span class="line">    static PostgreSQLContainer&lt;?&gt; postgres = new PostgreSQLContainer&lt;&gt;(&quot;postgres:13&quot;);</span>
<span class="line">    @DynamicPropertySource</span>
<span class="line">    static void configureProperties(DynamicPropertyRegistry registry) {</span>
<span class="line">        registry.add(&quot;spring.datasource.url&quot;, postgres::getJdbcUrl);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="弃用-不建议使用的测试工具" tabindex="-1"><a class="header-anchor" href="#弃用-不建议使用的测试工具"><span>弃用/不建议使用的测试工具</span></a></h2><ul><li><code>TestRestTemplate</code>：用于发送实际 HTTP 请求的测试工具类，端到端的 HTTP 接口测试 <ul><li>建议使用 <code>RestClient</code> 或 <code>WebTestClient</code></li></ul></li></ul>`,115)]))}const o=s(e,[["render",c]]),u=JSON.parse('{"path":"/test/framework/spring-boot-test.html","title":"Spring Boot 测试框架","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1764125251000,"contributors":[{"name":"zhaomy","username":"zhaomy","email":"3036190149@qq.com","commits":1,"url":"https://github.com/zhaomy"}],"changelog":[{"hash":"f9663e6d1eb00b8a13355bfcea00478d02431b74","time":1764125251000,"email":"3036190149@qq.com","author":"zhaomy","message":"docs: 添加测试技术文档和示例文件"}]},"filePathRelative":"test/framework/spring-boot-test.md","excerpt":"\\n<p>Spring Boot 提供了强大的测试支持，帮助开发者编写高效、可靠的单元测试和集成测试。下面详细介绍 Spring Boot 单元测试中涉及的主要注解、类和接口。</p>\\n<h2>一、核心测试注解</h2>\\n<table>\\n<thead>\\n<tr>\\n<th>维度</th>\\n<th>说明</th>\\n<th>注解</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>测试切片</td>\\n<td>仅加载特定层（如 Web、Data）的上下文，提升速度与专注度</td>\\n<td><code>@WebMvcTest</code>、 <code>@DataJpaTest</code>、 <code>@JdbcTest</code>、 <code>@JsonTest</code>、 <code>@RestClientTest</code></td>\\n</tr>\\n<tr>\\n<td>上下文控制</td>\\n<td>定制 Spring 应用上下文的加载范围与行为</td>\\n<td><code>@AutoConfigureTestDatabase</code>、 <code>@SpringBootTest</code>、 <code>@TestConfiguration</code></td>\\n</tr>\\n<tr>\\n<td>外部资源</td>\\n<td>管理测试所需的外部依赖（如数据库、消息队列）</td>\\n<td><code>@Testcontainers</code>、 <code>@Container</code>、 <code>@DynamicPropertySource</code></td>\\n</tr>\\n<tr>\\n<td>配置管理</td>\\n<td>覆盖或注入测试专用配置</td>\\n<td><code>@TestPropertySource</code>、 <code>@ActiveProfiles</code></td>\\n</tr>\\n<tr>\\n<td>生命周期与事务</td>\\n<td>控制测试执行流程与数据库事务行为</td>\\n<td><code>@BeforeEach</code>/<code>@AfterEach</code>、 <code>@Commit</code>/<code>@Rollback</code></td>\\n</tr>\\n<tr>\\n<td>HTTP 测试工具</td>\\n<td>模拟或真实调用 HTTP 接口</td>\\n<td><code>MockMvc</code>（模拟，用于 @WebMvcTest）、 <code>RestClient</code>（真实，用于 @SpringBootTest）</td>\\n</tr>\\n</tbody>\\n</table>"}');export{o as comp,u as data};

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Java 多线程编程 | My Blog</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="preload" href="/assets/style-CnXJ9Nmb.css" as="style"><link rel="stylesheet" href="/assets/style-CnXJ9Nmb.css">
    <link rel="modulepreload" href="/assets/app-ty-Ai2oG.js"><link rel="modulepreload" href="/assets/multithreading.html-BDwhkUS7.js">
    <link rel="prefetch" href="/assets/index.html-DLrIYmZ2.js" as="script"><link rel="prefetch" href="/assets/get-started.html-xfK_unUN.js" as="script"><link rel="prefetch" href="/assets/index.html-iToDBHPt.js" as="script"><link rel="prefetch" href="/assets/git-hooks.html-DKpv_l82.js" as="script"><link rel="prefetch" href="/assets/git-ssh.html-JZDihuG5.js" as="script"><link rel="prefetch" href="/assets/index.html-BSJQDCxE.js" as="script"><link rel="prefetch" href="/assets/index.html-CA11FwNw.js" as="script"><link rel="prefetch" href="/assets/index.html-CMovsGIL.js" as="script"><link rel="prefetch" href="/assets/yaml.html-DFaRQAs9.js" as="script"><link rel="prefetch" href="/assets/functools.html-C-1EVS3W.js" as="script"><link rel="prefetch" href="/assets/functools_wraps.html-CR-ejgCm.js" as="script"><link rel="prefetch" href="/assets/index.html-KsTf5nXN.js" as="script"><link rel="prefetch" href="/assets/requirements.html-BUiHIDac.js" as="script"><link rel="prefetch" href="/assets/wrapper.html-uo66rzFj.js" as="script"><link rel="prefetch" href="/assets/book-name-format.html-B1s3Pbg8.js" as="script"><link rel="prefetch" href="/assets/book.html-CHumxoZt.js" as="script"><link rel="prefetch" href="/assets/github.html-CfNpuA0Y.js" as="script"><link rel="prefetch" href="/assets/index.html-BimVnamW.js" as="script"><link rel="prefetch" href="/assets/code_tool_template.html-D7SM7TFD.js" as="script"><link rel="prefetch" href="/assets/index.html-CDu6Ky-N.js" as="script"><link rel="prefetch" href="/assets/tool_template.html-63IHuyiY.js" as="script"><link rel="prefetch" href="/assets/tutorial_website_setup_template.html-Kq2mZZIn.js" as="script"><link rel="prefetch" href="/assets/coze.html-DVvuzyS2.js" as="script"><link rel="prefetch" href="/assets/index.html-C0zv5C0A.js" as="script"><link rel="prefetch" href="/assets/instruction.html-CRMQI49h.js" as="script"><link rel="prefetch" href="/assets/prompt.html-D6Oy6-mf.js" as="script"><link rel="prefetch" href="/assets/quesion.html-DG10ibt_.js" as="script"><link rel="prefetch" href="/assets/trae-plugin.html-BqIklL54.js" as="script"><link rel="prefetch" href="/assets/github_action.html-DPN5ru7i.js" as="script"><link rel="prefetch" href="/assets/index.html-pXlrGldc.js" as="script"><link rel="prefetch" href="/assets/database-connection-pool.html-CYwuRdq7.js" as="script"><link rel="prefetch" href="/assets/index.html-osbQtR0w.js" as="script"><link rel="prefetch" href="/assets/multithreading_intro.html-CBG2MYFT.js" as="script"><link rel="prefetch" href="/assets/linked-hash-map-to-object.html-CGtO_vkb.js" as="script"><link rel="prefetch" href="/assets/index.html-_7p_r7rD.js" as="script"><link rel="prefetch" href="/assets/java_mail.html-C6UKQll1.js" as="script"><link rel="prefetch" href="/assets/java_mail_sender.html-BcHNtOyV.js" as="script"><link rel="prefetch" href="/assets/mail.html-DszurHOx.js" as="script"><link rel="prefetch" href="/assets/mail_smtp.html-CriUe7TC.js" as="script"><link rel="prefetch" href="/assets/ahead-of-time-method-profiling-intro.html-C5qUFO8Q.js" as="script"><link rel="prefetch" href="/assets/class-file-api-intro.html-DQxcBYm-.js" as="script"><link rel="prefetch" href="/assets/compact-object-headers-intro.html-Dp-ntW2G.js" as="script"><link rel="prefetch" href="/assets/flexible-constructor-bodies-intro.html-D3a4H30y.js" as="script"><link rel="prefetch" href="/assets/generational-shenandoah-intro.html-Av2_SZrG.js" as="script"><link rel="prefetch" href="/assets/index.html-CyIYnlQf.js" as="script"><link rel="prefetch" href="/assets/java-22-features.html-DIWufEsj.js" as="script"><link rel="prefetch" href="/assets/java-23-features.html-DAzXiG20.js" as="script"><link rel="prefetch" href="/assets/java-24-features.html-cYv1jKyg.js" as="script"><link rel="prefetch" href="/assets/java-25-features.html-DUmR2doJ.js" as="script"><link rel="prefetch" href="/assets/jer-445-463-477-495-512-intro.html-Bm1Kg6CD.js" as="script"><link rel="prefetch" href="/assets/jfr-cooperative-sampling-intro.html-CDimpK9P.js" as="script"><link rel="prefetch" href="/assets/module-Import-declarations-intro.html-BL7Rc6xF.js" as="script"><link rel="prefetch" href="/assets/prepare-to-restrict-the-use-of-jni-intro.html-CNIND0eF.js" as="script"><link rel="prefetch" href="/assets/primitive-types-in-patterns-instanceof-and-switch-intro.html-C-NvbTBv.js" as="script"><link rel="prefetch" href="/assets/primitive-types-in-patterns-instanceof-and-switch.html-D8rJ07rU.js" as="script"><link rel="prefetch" href="/assets/stable-values-intro.html-DHDWZdfy.js" as="script"><link rel="prefetch" href="/assets/structured-concurrency-guide.html-D8u_8jQk.js" as="script"><link rel="prefetch" href="/assets/structured-concurrency-intro.html-C6LHHlNK.js" as="script"><link rel="prefetch" href="/assets/vector-api-intro.html-CFWBOUzM.js" as="script"><link rel="prefetch" href="/assets/index.html-qvspoq4B.js" as="script"><link rel="prefetch" href="/assets/mybatis-annotation.html-D24W-i5A.js" as="script"><link rel="prefetch" href="/assets/mybatis-intro.html-BPCeNB0U.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus-code-generator.html-BDxlYEeL.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus-multi-tenant.html-DvYMU_18.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus-pagehelper.html-Da1MBXa-.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-2QrQxyNg.js" as="script"><link rel="prefetch" href="/assets/apache_common.html-Bu4aWzeH.js" as="script"><link rel="prefetch" href="/assets/file.html-CbRfox2S.js" as="script"><link rel="prefetch" href="/assets/file_utils.html-DHvXdyQu.js" as="script"><link rel="prefetch" href="/assets/hutool.html-Cabj708G.js" as="script"><link rel="prefetch" href="/assets/index.html-RDYPQrtw.js" as="script"><link rel="prefetch" href="/assets/index.html-BVxCQXal.js" as="script"><link rel="prefetch" href="/assets/nvm.html-Nm3h6sPo.js" as="script"><link rel="prefetch" href="/assets/index.html-ISNab_Ar.js" as="script"><link rel="prefetch" href="/assets/dynamic-programming-intro.html-uFtAx2ya.js" as="script"><link rel="prefetch" href="/assets/dynamic-programming.html-DAgNjKQ3.js" as="script"><link rel="prefetch" href="/assets/index.html-iHZSsLtb.js" as="script"><link rel="prefetch" href="/assets/index.html-CUE1oMQ1.js" as="script"><link rel="prefetch" href="/assets/index.html-CkZQCyIn.js" as="script"><link rel="prefetch" href="/assets/command.html-pjQiPkA7.js" as="script"><link rel="prefetch" href="/assets/index.html-BncpLrZZ.js" as="script"><link rel="prefetch" href="/assets/index.html-By892VPc.js" as="script"><link rel="prefetch" href="/assets/spring-boot-hello-world-intro.html-B27d9kRj.js" as="script"><link rel="prefetch" href="/assets/spring-boot-hello-world.html-BX8GzSFX.js" as="script"><link rel="prefetch" href="/assets/spring-boot-oracle.html-qhptct-r.js" as="script"><link rel="prefetch" href="/assets/spring-boot-redis-intro.html-Di1ThGup.js" as="script"><link rel="prefetch" href="/assets/spring-boot-redis.html-D4EbhmnI.js" as="script"><link rel="prefetch" href="/assets/spring-boot.html-BDgajHnj.js" as="script"><link rel="prefetch" href="/assets/spring-framework-aop-impi.html-DdWcgS50.js" as="script"><link rel="prefetch" href="/assets/spring-framework-aop.html-CBOzJHGI.js" as="script"><link rel="prefetch" href="/assets/spring-framework-ioc-impi.html-Bvx6Wx6M.js" as="script"><link rel="prefetch" href="/assets/spring-framework-ioc.html-DvdNLc4b.js" as="script"><link rel="prefetch" href="/assets/spring-framework.html-CTMATFPs.js" as="script"><link rel="prefetch" href="/assets/common_markdown.html-UYOQU_VW.js" as="script"><link rel="prefetch" href="/assets/common_summary.html-B1rGOJXI.js" as="script"><link rel="prefetch" href="/assets/css.html-whnHL3ZV.js" as="script"><link rel="prefetch" href="/assets/index.html-BT27FB5o.js" as="script"><link rel="prefetch" href="/assets/plugin.html-CHbyw3bd.js" as="script"><link rel="prefetch" href="/assets/vue-component.html-ChPDQ9l3.js" as="script"><link rel="prefetch" href="/assets/vuepress_cloud.html-CPhtJu74.js" as="script"><link rel="prefetch" href="/assets/index.html-CfKSymIu.js" as="script"><link rel="prefetch" href="/assets/requirement_v1.html-Bpr4k99w.js" as="script"><link rel="prefetch" href="/assets/fastjson2.html-CHaxDlzf.js" as="script"><link rel="prefetch" href="/assets/jackson.html-C2j9BMUk.js" as="script"><link rel="prefetch" href="/assets/index.html-Bk8QyOYr.js" as="script"><link rel="prefetch" href="/assets/itexpdf.html-DGaPHWO_.js" as="script"><link rel="prefetch" href="/assets/index.html-B3T4z4H8.js" as="script"><link rel="prefetch" href="/assets/load-balance.html-DkaxDlXr.js" as="script"><link rel="prefetch" href="/assets/suggest.html-C5dzzo8s.js" as="script"><link rel="prefetch" href="/assets/client.html-abqUtzcR.js" as="script"><link rel="prefetch" href="/assets/command.html-Bb_uAOAw.js" as="script"><link rel="prefetch" href="/assets/curator.html-CFW3ZmZc.js" as="script"><link rel="prefetch" href="/assets/index.html-DucKjZPM.js" as="script"><link rel="prefetch" href="/assets/zkclient.html-CNanVaGb.js" as="script"><link rel="prefetch" href="/assets/zookeeper_intro.html-CcJyM4ch.js" as="script"><link rel="prefetch" href="/assets/index.html-BIwhLTdV.js" as="script"><link rel="prefetch" href="/assets/multi-tenant.html-Bi3dyIbm.js" as="script"><link rel="prefetch" href="/assets/constraint.html-Betyjpr9.js" as="script"><link rel="prefetch" href="/assets/cursor.html-BDWw7Mz3.js" as="script"><link rel="prefetch" href="/assets/cursor_intro.html-DPbERj3U.js" as="script"><link rel="prefetch" href="/assets/index.html-BI8Ozn9o.js" as="script"><link rel="prefetch" href="/assets/index.html-BvEhjtPs.js" as="script"><link rel="prefetch" href="/assets/tencent-nginx.html-DJgeSx6e.js" as="script"><link rel="prefetch" href="/assets/tencent.html-ClOjXomW.js" as="script"><link rel="prefetch" href="/assets/index.html-C0cbHonY.js" as="script"><link rel="prefetch" href="/assets/nginx-problem.html-BiNOqIHs.js" as="script"><link rel="prefetch" href="/assets/nginx.html-D-tyISHd.js" as="script"><link rel="prefetch" href="/assets/index.html-D7XrkQs5.js" as="script"><link rel="prefetch" href="/assets/snowflake.html-C3Dw8ip1.js" as="script"><link rel="prefetch" href="/assets/index.html-7zDovRmB.js" as="script"><link rel="prefetch" href="/assets/404.html-NueMNEkL.js" as="script"><link rel="prefetch" href="/assets/index.html-D5mYZ_7n.js" as="script"><link rel="prefetch" href="/assets/index.html-DLLiPHQj.js" as="script"><link rel="prefetch" href="/assets/index.html-BRtUDzbe.js" as="script"><link rel="prefetch" href="/assets/index.html-DVqt6ekR.js" as="script"><link rel="prefetch" href="/assets/index.html-DtefR5hZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BXxGWFpX.js" as="script"><link rel="prefetch" href="/assets/index.html-YBwVlzZh.js" as="script"><link rel="prefetch" href="/assets/index.html-BobHojvO.js" as="script"><link rel="prefetch" href="/assets/index.html-Dlo63RI7.js" as="script"><link rel="prefetch" href="/assets/index.html-BMbHWSLe.js" as="script"><link rel="prefetch" href="/assets/index.html-D64o4ymz.js" as="script"><link rel="prefetch" href="/assets/index.html-DLw2OsL9.js" as="script"><link rel="prefetch" href="/assets/index.html-BFjijOTR.js" as="script"><link rel="prefetch" href="/assets/index.html-CddT7JEj.js" as="script"><link rel="prefetch" href="/assets/index.html-DaXOIcRo.js" as="script"><link rel="prefetch" href="/assets/index.html-D64o4ymz.js" as="script"><link rel="prefetch" href="/assets/index.html-DLw2OsL9.js" as="script"><link rel="prefetch" href="/assets/index.html-B-ATo01V.js" as="script"><link rel="prefetch" href="/assets/index.html-Bzi7NGFl.js" as="script"><link rel="prefetch" href="/assets/index.html-CAjZgO3P.js" as="script"><link rel="prefetch" href="/assets/index.html-13PKT1KU.js" as="script"><link rel="prefetch" href="/assets/index.html-BIX6N9Rj.js" as="script"><link rel="prefetch" href="/assets/index.html-V8F9UMIF.js" as="script"><link rel="prefetch" href="/assets/index.html-CgjLs7b3.js" as="script"><link rel="prefetch" href="/assets/index.html-DWtZ-PdZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BAx8ouV7.js" as="script"><link rel="prefetch" href="/assets/index.html-NPYmPbRV.js" as="script"><link rel="prefetch" href="/assets/index.html-CNaVHEEB.js" as="script"><link rel="prefetch" href="/assets/index.html-Cz-Xxqmp.js" as="script"><link rel="prefetch" href="/assets/index.html-DlGAQNQ-.js" as="script"><link rel="prefetch" href="/assets/index.html-B4e6NiRJ.js" as="script"><link rel="prefetch" href="/assets/index.html-cXXie1Px.js" as="script"><link rel="prefetch" href="/assets/index.html-D33zwPi5.js" as="script"><link rel="prefetch" href="/assets/index.html-DpQleCFj.js" as="script"><link rel="prefetch" href="/assets/index.html-Ci5q_IAj.js" as="script"><link rel="prefetch" href="/assets/index.html-k2T3wNgK.js" as="script"><link rel="prefetch" href="/assets/index.html-CGRiWGBb.js" as="script"><link rel="prefetch" href="/assets/index.html-BdQfU8U7.js" as="script"><link rel="prefetch" href="/assets/index.html-Dlk8E527.js" as="script"><link rel="prefetch" href="/assets/index.html-BC5fUo_p.js" as="script"><link rel="prefetch" href="/assets/index.html-L8YJoCVr.js" as="script"><link rel="prefetch" href="/assets/index.html-BaiWIq3k.js" as="script"><link rel="prefetch" href="/assets/index.html-BRB0sBTE.js" as="script"><link rel="prefetch" href="/assets/index.html-bhFpYcg6.js" as="script"><link rel="prefetch" href="/assets/index.html-CKs5h2UG.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-DrELB38J.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/logo.png" alt="My Blog"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">My Blog</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/resource/" aria-label="资源"><!--[--><!--[--><!--]--><!--]-->资源<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/java/" aria-label="Java"><!--[--><!--[--><!--]--><!--]-->Java<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="Spring"><!--[--><!--[--><!--]--><!--]-->Spring<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/arch/" aria-label="架构"><!--[--><!--[--><!--]--><!--]-->架构<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/db/" aria-label="数据库"><!--[--><!--[--><!--]--><!--]-->数据库<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/linux/" aria-label="Linux"><!--[--><!--[--><!--]--><!--]-->Linux<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/git/" aria-label="Git"><!--[--><!--[--><!--]--><!--]-->Git<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/vuepress/" aria-label="VuePress"><!--[--><!--[--><!--]--><!--]-->VuePress<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/others/" aria-label="杂项"><!--[--><!--[--><!--]--><!--]-->杂项<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/resource/" aria-label="资源"><!--[--><!--[--><!--]--><!--]-->资源<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/java/" aria-label="Java"><!--[--><!--[--><!--]--><!--]-->Java<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/spring/" aria-label="Spring"><!--[--><!--[--><!--]--><!--]-->Spring<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/arch/" aria-label="架构"><!--[--><!--[--><!--]--><!--]-->架构<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/db/" aria-label="数据库"><!--[--><!--[--><!--]--><!--]-->数据库<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/linux/" aria-label="Linux"><!--[--><!--[--><!--]--><!--]-->Linux<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/git/" aria-label="Git"><!--[--><!--[--><!--]--><!--]-->Git<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/posts/vuepress/" aria-label="VuePress"><!--[--><!--[--><!--]--><!--]-->VuePress<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/others/" aria-label="杂项"><!--[--><!--[--><!--]--><!--]-->杂项<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading" href="/java/" aria-label="Java"><!--[--><!--[--><!--]--><!--]-->Java<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/java/new-features/" aria-label="Java 新特性"><!--[--><!--[--><!--]--><!--]-->Java 新特性<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/new-features/java-25-features.html" aria-label="Java 25 新特性"><!--[--><!--[--><!--]--><!--]-->Java 25 新特性<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/new-features/java-24-features.html" aria-label="Java 24 新特性"><!--[--><!--[--><!--]--><!--]-->Java 24 新特性<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/new-features/java-23-features.html" aria-label="Java 23 新特性"><!--[--><!--[--><!--]--><!--]-->Java 23 新特性<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/new-features/java-22-features.html" aria-label="Java 22 新特性"><!--[--><!--[--><!--]--><!--]-->Java 22 新特性<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/java/intermediate/" aria-label="Java 中级"><!--[--><!--[--><!--]--><!--]-->Java 中级<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/java/intermediate/multithreading.html" aria-label="Java 多线程编程"><!--[--><!--[--><!--]--><!--]-->Java 多线程编程<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">工具库 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/utils/file_utils.html" aria-label="FileUtils"><!--[--><!--[--><!--]--><!--]-->FileUtils<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/utils/pdf_utils/" aria-label="PDFUtils"><!--[--><!--[--><!--]--><!--]-->PDFUtils<!--[--><!--[--><!--]--><!--]--></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/utils/pdf_utils/itexpdf.html" aria-label="itexpdf"><!--[--><!--[--><!--]--><!--]-->itexpdf<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/utils/apache_common.html" aria-label="Apache Common"><!--[--><!--[--><!--]--><!--]-->Apache Common<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/utils/hutool.html" aria-label="hutool"><!--[--><!--[--><!--]--><!--]-->hutool<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">ORM <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/orm/mybatis.html" aria-label="MyBatis"><!--[--><!--[--><!--]--><!--]-->MyBatis<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/orm/mybatis-annotation.html" aria-label="MyBatis/MyBatis-Plus注解"><!--[--><!--[--><!--]--><!--]-->MyBatis/MyBatis-Plus注解<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">模块 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/module/mail.html" aria-label="Java 邮件服务"><!--[--><!--[--><!--]--><!--]-->Java 邮件服务<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/module/java_mail.html" aria-label="JavaMail"><!--[--><!--[--><!--]--><!--]-->JavaMail<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/module/java_mail_sender.html" aria-label="JavaMailSender"><!--[--><!--[--><!--]--><!--]-->JavaMailSender<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">其他 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><p tabindex="0" class="vp-sidebar-item">Json <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/java/misc/json/fastjson2.html" aria-label="fastjson2"><!--[--><!--[--><!--]--><!--]-->fastjson2<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/misc/json/jackson.html" aria-label="Jackson库详解"><!--[--><!--[--><!--]--><!--]-->Jackson库详解<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="/java/misc/linked-hash-map-to-object.html" aria-label="LinkedHashMap解析"><!--[--><!--[--><!--]--><!--]-->LinkedHashMap解析<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="java-多线程编程" tabindex="-1"><a class="header-anchor" href="#java-多线程编程"><span>Java 多线程编程</span></a></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程的基本概念" class="router-link-active router-link-exact-active">线程的基本概念</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#什么是线程" class="router-link-active router-link-exact-active">什么是线程</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程的创建方式" class="router-link-active router-link-exact-active">线程的创建方式</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程的生命周期" class="router-link-active router-link-exact-active">线程的生命周期</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程同步机制" class="router-link-active router-link-exact-active">线程同步机制</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#同步机制分类" class="router-link-active router-link-exact-active">同步机制分类</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#synchronized关键字" class="router-link-active router-link-exact-active">synchronized关键字</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#显式锁-lock" class="router-link-active router-link-exact-active">显式锁(Lock)</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#读写锁-readwritelock" class="router-link-active router-link-exact-active">读写锁(ReadWriteLock)</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程安全集合" class="router-link-active router-link-exact-active">线程安全集合</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#同步机制的选择" class="router-link-active router-link-exact-active">同步机制的选择</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程池与executor框架" class="router-link-active router-link-exact-active">线程池与Executor框架</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#框架概述" class="router-link-active router-link-exact-active">框架概述</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#executor接口" class="router-link-active router-link-exact-active">Executor接口</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#executorservice接口" class="router-link-active router-link-exact-active">ExecutorService接口</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#threadpoolexecutor" class="router-link-active router-link-exact-active">ThreadPoolExecutor</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#future与futuretask" class="router-link-active router-link-exact-active">Future与FutureTask</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#常见线程池类型" class="router-link-active router-link-exact-active">常见线程池类型</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程池的使用步骤" class="router-link-active router-link-exact-active">线程池的使用步骤</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#线程池使用的最佳实践" class="router-link-active router-link-exact-active">线程池使用的最佳实践</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#工具类" class="router-link-active router-link-exact-active">工具类</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#executors" class="router-link-active router-link-exact-active">Executors</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#executorcompletionservice" class="router-link-active router-link-exact-active">ExecutorCompletionService</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#高级并发工具" class="router-link-active router-link-exact-active">高级并发工具</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#countdownlatch" class="router-link-active router-link-exact-active">CountDownLatch</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#cyclicbarrier" class="router-link-active router-link-exact-active">CyclicBarrier</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#semaphore" class="router-link-active router-link-exact-active">Semaphore</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#completablefuture" class="router-link-active router-link-exact-active">CompletableFuture</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#springboot中的线程池" class="router-link-active router-link-exact-active">SpringBoot中的线程池</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#常见对比" class="router-link-active router-link-exact-active">常见对比</a><ul><li><a aria-current="page" href="/java/intermediate/multithreading.html#countdownlatch-vs-cyclicbarrier" class="router-link-active router-link-exact-active">CountDownLatch VS CyclicBarrier</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#semaphore-vs-锁" class="router-link-active router-link-exact-active">Semaphore VS 锁</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#runnable-vs-callable" class="router-link-active router-link-exact-active">Runnable vs Callable</a></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#completablefuture-vs-executorservice" class="router-link-active router-link-exact-active">CompletableFuture vs ExecutorService</a></li></ul></li><li><a aria-current="page" href="/java/intermediate/multithreading.html#注意事项" class="router-link-active router-link-exact-active">注意事项</a></li></ul></nav><p>在Java中，多线程是一种并发编程技术，允许程序同时执行多个任务。通过多线程，可以充分利用CPU资源，提高程序的执行效率和响应速度。Java提供了丰富的API来支持多线程编程，主要通过<code>java.lang.Thread</code>类和<code>java.util.concurrent</code>包来实现。</p><p>这篇文章主要介绍Java多线程编程的基础知识，包括以下内容：</p><ul><li>线程的创建、启动、同步、通信与死锁等基本概念。</li><li>线程同步机制，包括：synchronized关键字、显式锁、读写锁和线程安全集合等，确保多线程环境下数据的一致性和安全性。</li><li>线程池和Executor框架，核心组件包括Executor、Future等接口及其实现类，通过合理配置线程池参数（核心线程数、最大线程数、工作队列等），优化线程资源的管理和使用。</li><li>高级并发工具（CountDownLatch、CyclicBarrier、Semaphore、CompletableFuture等）的特性与应用。</li></ul><p>本文是Java多线程编程的快速入门指南，将帮助你建立并发编程的基本概念和使用技能。 详细的JUC（Java并发工具包）相关类的深入解析和实战应用，将在后续文章中陆续介绍。</p><h2 id="线程的基本概念" tabindex="-1"><a class="header-anchor" href="#线程的基本概念"><span>线程的基本概念</span></a></h2><h3 id="什么是线程" tabindex="-1"><a class="header-anchor" href="#什么是线程"><span>什么是线程</span></a></h3><p>线程是程序执行的最小单位，一个进程可以包含多个线程，每个线程都有自己的执行路径，但共享进程的内存空间和系统资源。多线程可以提高程序的执行效率，充分利用CPU资源。</p><h3 id="线程的创建方式" tabindex="-1"><a class="header-anchor" href="#线程的创建方式"><span>线程的创建方式</span></a></h3><p>在Java中，创建线程主要有以下三种方式：</p><h4 id="继承thread类" tabindex="-1"><a class="header-anchor" href="#继承thread类"><span>继承Thread类</span></a></h4><p>通过继承<code>Thread</code>类并重写<code>run()</code>方法来创建线程：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用方式</span></span>
<span class="line"><span class="token class-name">MyThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;自定义线程名&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置线程名称</span></span>
<span class="line">thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动线程，调用run()方法</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="实现runnable接口" tabindex="-1"><a class="header-anchor" href="#实现runnable接口"><span>实现Runnable接口</span></a></h4><p>实现<code>Runnable</code>接口并传入<code>Thread</code>构造函数：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用方式</span></span>
<span class="line"><span class="token class-name">MyRunnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> <span class="token string">&quot;自定义线程名&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用callable和future" tabindex="-1"><a class="header-anchor" href="#使用callable和future"><span>使用Callable和Future</span></a></h4><p>对于需要返回结果的线程，可以使用<code>Callable</code>和<code>Future</code>：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">FutureTask</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟耗时操作</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: 线程执行结果&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用方式</span></span>
<span class="line"><span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span> <span class="token string">&quot;自定义线程名&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> result <span class="token operator">=</span> futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻塞等待线程执行完成并获取结果</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="线程的生命周期" tabindex="-1"><a class="header-anchor" href="#线程的生命周期"><span>线程的生命周期</span></a></h3><p>线程有以下几种状态，它们之间可以相互转换：</p><table><thead><tr><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>新建(NEW)</td><td>线程被创建但未启动</td></tr><tr><td>就绪(RUNNABLE)</td><td>线程可运行，但可能正在等待CPU资源</td></tr><tr><td>运行(RUNNING)</td><td>线程正在执行</td></tr><tr><td>阻塞(BLOCKED)</td><td>线程因等待锁而暂时不能继续执行</td></tr><tr><td>等待(WAITING)</td><td>线程等待其他线程执行特定操作，无超时限制</td></tr><tr><td>计时等待(TIMED_WAITING)</td><td>线程在指定时间内等待</td></tr><tr><td>终止(TERMINATED)</td><td>线程执行完成</td></tr></tbody></table><h2 id="线程同步机制" tabindex="-1"><a class="header-anchor" href="#线程同步机制"><span>线程同步机制</span></a></h2><p>在多线程环境中，多个线程可能会同时访问共享资源，导致数据不一致的问题。这种情况被称为<strong>竞态条件</strong>（Race Condition）。Java提供了多种机制来实现线程同步，确保在多线程环境下共享资源的一致性和安全性。</p><h3 id="同步机制分类" tabindex="-1"><a class="header-anchor" href="#同步机制分类"><span>同步机制分类</span></a></h3><p>Java中的线程同步机制主要分为以下几类：</p><table><thead><tr><th>同步机制</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td><code>synchronized</code> 关键字</td><td>简单易用，隐式获取和释放锁</td><td>简单的同步场景</td></tr><tr><td>显式锁（如<code>ReentrantLock</code>）</td><td>更灵活，支持公平锁、可中断锁等高级特性</td><td>复杂的同步场景</td></tr><tr><td>读写锁（如<code>ReentrantReadWriteLock</code>）</td><td>允许多个线程同时读，写操作互斥</td><td>读多写少的场景</td></tr><tr><td>线程安全集合（如<code>ConcurrentHashMap</code>）</td><td>内部实现线程安全，无需额外同步</td><td>多线程共享集合数据</td></tr></tbody></table><h3 id="synchronized关键字" tabindex="-1"><a class="header-anchor" href="#synchronized关键字"><span>synchronized关键字</span></a></h3><p><code>synchronized</code>是Java中最基本的同步机制，它可以修饰方法或代码块，确保同一时间只有一个线程可以执行被修饰的代码。<code>synchronized</code>基于对象监视器（Monitor）实现，具有以下特点：</p><ul><li>自动获取和释放锁</li><li>不可中断</li><li>非公平锁</li><li>可重入（一个线程可以多次获取同一个锁）</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// 修饰实例方法</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">synchronizedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 同步代码</span></span>
<span class="line">    <span class="token comment">// 锁对象是当前实例（this）</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 修饰静态方法</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">staticSynchronizedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 同步代码</span></span>
<span class="line">    <span class="token comment">// 锁对象是当前类的Class对象</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 修饰代码块</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">synchronizedBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 非同步代码</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 同步代码块，锁对象是this</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 同步代码</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 同步代码块，锁对象是class对象</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">MyClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 同步代码</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 同步代码块，锁对象是任意对象</span></span>
<span class="line">    <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 同步代码</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="显式锁-lock" tabindex="-1"><a class="header-anchor" href="#显式锁-lock"><span>显式锁(Lock)</span></a></h3><p><code>java.util.concurrent.locks</code>包提供了更灵活的锁机制，主要接口是<code>Lock</code>，常用实现类有<code>ReentrantLock</code>和<code>StampedLock</code>。与<code>synchronized</code>相比，显式锁具有以下优势：</p><ul><li>支持公平锁</li><li>支持可中断锁</li><li>支持超时获取锁</li><li>支持尝试获取锁</li><li>可以实现更复杂的同步模式</li></ul><h4 id="reentrantlock" tabindex="-1"><a class="header-anchor" href="#reentrantlock"><span>ReentrantLock</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantLockDemo</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 创建可重入锁，参数为true表示公平锁</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 尝试获取锁，如果获取不到则阻塞</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 同步代码</span></span>
<span class="line">            count<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: count = &quot;</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 确保锁被释放，防止死锁</span></span>
<span class="line">            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tryIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 尝试获取锁，如果获取不到立即返回false</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                count<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: count = &quot;</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 获取锁失败，可以执行其他逻辑</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: 获取锁失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="stampedlock" tabindex="-1"><a class="header-anchor" href="#stampedlock"><span>StampedLock</span></a></h4><p><code>StampedLock</code>是Java 8引入的新锁机制，它虽然实现了<code>Lock</code>接口，但同时支持读写分离，功能上类似读写锁。与<code>ReentrantReadWriteLock</code>相比，<code>StampedLock</code>提供了乐观读模式，在高并发读场景下性能更好。 <code>StampedLock</code>的主要优势在于：</p><ul><li>乐观读模式减少了锁竞争，提高了读操作的并发性能</li><li>使用戳记（stamp）而非锁对象，降低了内存开销</li><li>支持锁的升级和降级（但需要手动实现）</li></ul><p>需要注意的是，<code>StampedLock</code>不支持重入，也不支持条件变量，使用时需要特别小心。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">StampedLock</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StampedLockDemo</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StampedLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 写操作</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">double</span> deltaX<span class="token punctuation">,</span> <span class="token keyword">double</span> deltaY<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">long</span> stamp <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            x <span class="token operator">+=</span> deltaX<span class="token punctuation">;</span></span>
<span class="line">            y <span class="token operator">+=</span> deltaY<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            lock<span class="token punctuation">.</span><span class="token function">unlockWrite</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 乐观读操作</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">long</span> stamp <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">double</span> currentX <span class="token operator">=</span> x<span class="token punctuation">,</span> currentY <span class="token operator">=</span> y<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 检查读期间是否有写操作</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lock<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 如果有写操作，升级为悲观读锁</span></span>
<span class="line">            stamp <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                currentX <span class="token operator">=</span> x<span class="token punctuation">;</span></span>
<span class="line">                currentY <span class="token operator">=</span> y<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">                lock<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>currentX <span class="token operator">*</span> currentX <span class="token operator">+</span> currentY <span class="token operator">*</span> currentY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="读写锁-readwritelock" tabindex="-1"><a class="header-anchor" href="#读写锁-readwritelock"><span>读写锁(ReadWriteLock)</span></a></h3><p>读写锁允许多个线程同时读，但写操作是互斥的。这种机制在<strong>读多写少</strong>的场景下可以提高并发性能。<code>ReentrantReadWriteLock</code>是Java中最常用的读写锁实现。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReadWriteLock</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantReadWriteLock</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadWriteLockDemo</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReadWriteLock</span> rwLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 读操作</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">readData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rwLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 多个线程可以同时执行读操作</span></span>
<span class="line">            <span class="token keyword">return</span> data<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            rwLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 写操作</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeData</span><span class="token punctuation">(</span><span class="token keyword">int</span> newData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rwLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 写操作是互斥的</span></span>
<span class="line">            data <span class="token operator">=</span> newData<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            rwLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="线程安全集合" tabindex="-1"><a class="header-anchor" href="#线程安全集合"><span>线程安全集合</span></a></h3><p>在多线程环境中，Java提供了专门的线程安全集合类，位于<code>java.util.concurrent</code>包中。这些集合类内部实现了线程安全机制，无需额外同步。</p><h4 id="常用线程安全集合" tabindex="-1"><a class="header-anchor" href="#常用线程安全集合"><span>常用线程安全集合</span></a></h4><table><thead><tr><th>集合类</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td><code>ConcurrentHashMap</code></td><td>线程安全的HashMap实现，支持高并发读写</td><td>多线程共享键值对数据</td></tr><tr><td><code>CopyOnWriteArrayList</code></td><td>读多写少场景下的线程安全列表</td><td>频繁读取，偶尔修改的场景</td></tr><tr><td><code>CopyOnWriteArraySet</code></td><td>基于CopyOnWriteArrayList的线程安全集合</td><td>读多写少的集合场景</td></tr><tr><td><code>ConcurrentLinkedQueue</code></td><td>无界线程安全队列</td><td>高并发下的队列操作</td></tr><tr><td><code>LinkedBlockingQueue</code></td><td>基于链表的有界阻塞队列</td><td>生产者-消费者模式</td></tr><tr><td><code>ArrayBlockingQueue</code></td><td>基于数组的有界阻塞队列</td><td>固定大小的队列场景</td></tr></tbody></table><h4 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// ConcurrentHashMap示例</span></span>
<span class="line"><span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 原子操作，如果key不存在则添加</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 原子更新操作</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">computeIfPresent</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 2</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// CopyOnWriteArrayList示例</span></span>
<span class="line"><span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;item1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;item2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 遍历不需要额外同步</span></span>
<span class="line">list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// BlockingQueue示例</span></span>
<span class="line"><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 生产者线程</span></span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        queue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;task1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        queue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;task2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 消费者线程</span></span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: task1</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: task2</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="同步机制的选择" tabindex="-1"><a class="header-anchor" href="#同步机制的选择"><span>同步机制的选择</span></a></h3><p>选择合适的同步机制对于多线程程序的性能和正确性至关重要。以下是一些选择建议：</p><ol><li>简单同步需求：优先使用<code>synchronized</code>，因为它简单易用，且JVM会对其进行优化。</li><li>复杂同步需求：使用<code>ReentrantLock</code>，它支持公平锁、可中断锁等高级特性。</li><li>读多写少场景：优先考虑<code>StampedLock</code>，其次是<code>ReentrantReadWriteLock</code>。</li><li>集合操作：使用<code>java.util.concurrent</code>包中的线程安全集合。</li></ol><h2 id="线程池与executor框架" tabindex="-1"><a class="header-anchor" href="#线程池与executor框架"><span>线程池与Executor框架</span></a></h2><p>在Java多线程编程中，频繁创建和销毁线程会带来较大的性能开销。线程池技术通过重用线程、控制线程数量和管理任务队列，有效提高了多线程程序的性能和可管理性。Executor框架是Java提供的一套完整的线程池管理解决方案。</p><h3 id="框架概述" tabindex="-1"><a class="header-anchor" href="#框架概述"><span>框架概述</span></a></h3><p>Executor框架 是一个包含线程池管理、任务调度和异步执行的整体架构，主要由以下组件构成：</p><table><thead><tr><th>组件</th><th>作用</th></tr></thead><tbody><tr><td>任务(Runnable/Callable)</td><td>定义需要执行的工作单元</td></tr><tr><td>执行器(Executor/ExecutorService)</td><td>负责任务的提交和执行</td></tr><tr><td>线程池(ThreadPoolExecutor)</td><td>管理线程的创建、复用和销毁</td></tr><tr><td>异步结果(Future/FutureTask)</td><td>表示异步执行的结果</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">提示</p><p>ThreadPoolExecutor 是 ExecutorService 的实现类，提供了更丰富的线程池管理功能。</p></div><h3 id="executor接口" tabindex="-1"><a class="header-anchor" href="#executor接口"><span>Executor接口</span></a></h3><p><code>Executor</code>是Executor框架的基础接口，定义了任务执行的核心方法：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Executor</code>的核心设计理念是<strong>将任务的提交与执行解耦</strong>，使调用者无需关心线程的创建、调度和销毁细节。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>它只负责执行提交的 <code>Runnable</code> 任务，但不提供任务执行的生命周期管理、任务结果的获取等功能。</p></div><h4 id="executor的优势" tabindex="-1"><a class="header-anchor" href="#executor的优势"><span>Executor的优势</span></a></h4><ul><li><strong>简化线程管理</strong>：无需手动创建和管理线程</li><li><strong>提高性能</strong>：通过线程重用减少线程创建和销毁的开销</li><li><strong>避免资源耗尽</strong>：可以控制并发线程数量</li><li><strong>防止this逃逸</strong>：延迟执行任务，避免对象构造期间的并发访问问题</li></ul><blockquote><p>this逃逸是指在构造函数中，将this引用传递给其他线程，导致其他线程在对象构造完成前访问该对象，可能引发并发问题。使用Executor延迟执行任务，可以避免这个问题。</p></blockquote><h3 id="executorservice接口" tabindex="-1"><a class="header-anchor" href="#executorservice接口"><span>ExecutorService接口</span></a></h3><p><code>ExecutorService</code>是<code>Executor</code>的子接口，扩展了线程池管理功能，提供了更丰富的API。</p><h4 id="核心功能" tabindex="-1"><a class="header-anchor" href="#核心功能"><span>核心功能</span></a></h4><ol><li><strong>任务提交</strong>：支持提交<code>Runnable</code>和<code>Callable</code>任务，并返回 <code>Future</code> 对象以获取任务结果。</li><li><strong>线程池生命周期管理</strong>：提供关闭、终止检查等方法</li><li><strong>批量任务处理</strong>：支持批量提交任务并获取结果（如 <code>invokeAll</code> 和 <code>invokeAny</code>）。</li></ol><h4 id="重要方法" tabindex="-1"><a class="header-anchor" href="#重要方法"><span>重要方法</span></a></h4><p>提交任务</p><ul><li><code>void execute(Runnable command)</code><br> 提交一个 <code>Runnable</code> 任务，没有返回值。</li><li><code>Future&lt;?&gt; submit(Runnable task)</code><br> 提交一个 <code>Runnable</code> 任务，返回一个 <code>Future</code> 对象，可以用于检查任务是否完成。</li><li><code>Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code><br> 提交一个 <code>Callable</code> 任务，返回一个 <code>Future</code> 对象，可以获取任务的返回值。</li></ul><p>关闭线程池</p><ul><li><code>void shutdown()</code><br> 平缓关闭线程池：不再接受新任务，但会等待已提交的任务执行完成。</li><li><code>List&lt;Runnable&gt; shutdownNow()</code><br> 立即关闭线程池：尝试停止所有正在执行的任务，并返回等待执行的任务列表。</li><li><code>boolean isShutdown()</code><br> 检查线程池是否已关闭。</li><li><code>boolean isTerminated()</code><br> 检查线程池是否完全终止（所有任务执行完毕）。</li></ul><p>获取任务结果</p><ul><li><code>Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code><br> 提交一个 <code>Callable</code> 任务，返回一个 <code>Future</code> 对象，可以通过 <code>Future.get()</code> 获取任务的返回值。</li><li><code>T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code><br> 执行一组任务，返回其中一个成功完成的任务的结果（任意一个）。</li><li><code>List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code><br> 执行一组任务，返回所有任务的 <code>Future</code> 列表。</li></ul><h4 id="使用示例-1" tabindex="-1"><a class="header-anchor" href="#使用示例-1"><span>使用示例</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">// 创建线程池</span></span>
<span class="line"><span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 提交Runnable任务</span></span>
<span class="line">executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 执行Runnable任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 提交Callable任务</span></span>
<span class="line"><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 执行Callable任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;任务执行结果&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取任务结果</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻塞等待任务完成</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务结果: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 关闭线程池</span></span>
<span class="line">executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="threadpoolexecutor" tabindex="-1"><a class="header-anchor" href="#threadpoolexecutor"><span>ThreadPoolExecutor</span></a></h3><p><code>ThreadPoolExecutor</code>是<code>ExecutorService</code>的核心实现类，提供了完整的线程池功能。</p><h4 id="工作原理" tabindex="-1"><a class="header-anchor" href="#工作原理"><span>工作原理</span></a></h4><ol><li>当提交任务时，如果当前线程数小于核心线程数(<code>corePoolSize</code>)，则创建新线程执行任务</li><li>如果当前线程数达到核心线程数，则将任务加入工作队列(<code>workQueue</code>)</li><li>如果工作队列已满，则创建非核心线程执行任务，直到达到最大线程数(<code>maximumPoolSize</code>)</li><li>如果超过最大线程数，则执行饱和策略(<code>handler</code>)</li></ol><h4 id="构造函数" tabindex="-1"><a class="header-anchor" href="#构造函数"><span>构造函数</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>                    <span class="token comment">// 核心线程数</span></span>
<span class="line">    <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>                 <span class="token comment">// 最大线程数</span></span>
<span class="line">    <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>                  <span class="token comment">// 非核心线程空闲时间</span></span>
<span class="line">    <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>                       <span class="token comment">// 时间单位</span></span>
<span class="line">    <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>   <span class="token comment">// 工作队列</span></span>
<span class="line">    <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>         <span class="token comment">// 线程工厂</span></span>
<span class="line">    <span class="token class-name">RejectedExecutionHandler</span> handler     <span class="token comment">// 饱和策略</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 构造函数实现</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="核心参数" tabindex="-1"><a class="header-anchor" href="#核心参数"><span>核心参数</span></a></h4><ul><li>corePoolSize：核心线程数，线程池保持的最小线程数量</li><li>maximumPoolSize：最大线程数，线程池允许创建的最大线程数量</li><li>workQueue：工作队列，用于存储等待执行的任务，常见类型： <ul><li><code>LinkedBlockingQueue</code>：无界队列，可能导致内存溢出</li><li><code>ArrayBlockingQueue</code>：有界队列，需要指定容量</li><li><code>SynchronousQueue</code>：同步队列，不存储任务，直接传递给线程</li></ul></li><li>keepAliveTime：非核心线程的空闲存活时间</li><li>unit：keepAliveTime参数的时间单位</li><li>threadFactory：线程工厂，用于创建新线程，可以自定义线程名称等属性</li><li>handler：饱和策略，当线程数达到最大且队列满时的处理策略</li></ul><h4 id="饱和策略" tabindex="-1"><a class="header-anchor" href="#饱和策略"><span>饱和策略</span></a></h4><table><thead><tr><th>策略</th><th>描述</th></tr></thead><tbody><tr><td><code>AbortPolicy</code></td><td>默认策略，抛出<code>RejectedExecutionException</code>异常</td></tr><tr><td><code>CallerRunsPolicy</code></td><td>由调用者线程执行被拒绝的任务</td></tr><tr><td><code>DiscardPolicy</code></td><td>直接丢弃被拒绝的任务</td></tr><tr><td><code>DiscardOldestPolicy</code></td><td>丢弃队列中最旧的任务，尝试提交新任务</td></tr></tbody></table><h4 id="最佳配置实践" tabindex="-1"><a class="header-anchor" href="#最佳配置实践"><span>最佳配置实践</span></a></h4><ul><li>CPU密集型任务：核心线程数 = CPU核心数 + 1</li><li>IO密集型任务：核心线程数 = CPU核心数 * 2</li><li>队列选择：有限使用有界队列避免内存溢出风险</li><li>饱和策略，建议使用 AbortPolicy 并捕获异常，以便及时发现问题</li><li>避免使用 Executors 工具类创建线程池：手动创建<code>ThreadPoolExecutor</code>以明确配置参数</li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><p>避免使用<code>Executors</code>工具类创建线程池的原因：</p><ul><li><code>FixedThreadPool</code>和<code>SingleThreadExecutor</code>使用无界队列，可能导致内存溢出</li><li><code>CachedThreadPool</code>和<code>ScheduledThreadPool</code>允许创建无限多线程，可能耗尽系统资源</li></ul></div><h3 id="future与futuretask" tabindex="-1"><a class="header-anchor" href="#future与futuretask"><span>Future与FutureTask</span></a></h3><p>Future 与 FutureTask 是Java并发编程中用于处理异步任务结果的重要组件。</p><h4 id="future-接口" tabindex="-1"><a class="header-anchor" href="#future-接口"><span>Future 接口</span></a></h4><p>Future 是一个接口，代表异步执行的结果，主要作用是：</p><ul><li>表示异步任务的执行状态（未开始、执行中、已完成、已取消）</li><li>获取异步任务的执行结果</li><li>取消尚未完成的任务</li></ul><p>它提供了以下核心方法：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">boolean</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> mayInterruptIfRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 取消任务</span></span>
<span class="line">    <span class="token keyword">boolean</span> <span class="token function">isCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 判断任务是否被取消</span></span>
<span class="line">    <span class="token keyword">boolean</span> <span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 判断任务是否已完成</span></span>
<span class="line">    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>  <span class="token comment">// 获取任务结果（阻塞）</span></span>
<span class="line">    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>  <span class="token comment">// 带超时的获取结果</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="futuretask-实现类" tabindex="-1"><a class="header-anchor" href="#futuretask-实现类"><span>FutureTask 实现类</span></a></h4><p><code>FutureTask</code> 是 <code>Future</code> 接口的实现类，同时也实现了 <code>Runnable</code> 接口，因此它既可以作为 <code>Runnable</code> 提交给线程池执行，也可以作为 <code>Future</code> 获取任务结果。</p><p><code>FutureTask</code> 通常用于包装 <code>Callable</code> 或 <code>Runnable</code> 任务，以便在任务完成后获取其结果。</p><p><code>FutureTask</code> 的应用场景：</p><ol><li>异步任务执行：将任务提交给线程池或线程执行，并在需要时获取任务结果。</li><li>任务取消：通过 <code>cancel()</code> 方法取消尚未完成的任务。</li><li>超时控制：使用 <code>get(long timeout, TimeUnit unit)</code> 方法设置超时时间，避免无限等待。</li><li>任务结果缓存：将任务结果缓存到 <code>FutureTask</code> 中，避免重复计算。</li><li>任务依赖：在多个任务之间存在依赖关系时，可以使用 <code>FutureTask</code> 来管理任务的执行顺序。</li></ol><h4 id="代码示例" tabindex="-1"><a class="header-anchor" href="#代码示例"><span>代码示例</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 创建线程池</span></span>
<span class="line">        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 示例1: 使用Future获取Callable任务的结果</span></span>
<span class="line">        <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> callableTask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 模拟耗时操作</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>callableTask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务提交成功，等待结果...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 可以做其他事情</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;主线程继续执行其他任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 获取结果（会阻塞直到任务完成）</span></span>
<span class="line">        <span class="token class-name">Integer</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务结果: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 示例2: 使用FutureTask</span></span>
<span class="line">        <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> anotherTask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token string">&quot;Hello, FutureTask!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 创建FutureTask</span></span>
<span class="line">        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>anotherTask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 提交FutureTask</span></span>
<span class="line">        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 检查任务是否完成</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>futureTask<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;FutureTask任务正在执行...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 获取结果</span></span>
<span class="line">        <span class="token class-name">String</span> taskResult <span class="token operator">=</span> futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;FutureTask结果: &quot;</span> <span class="token operator">+</span> taskResult<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 关闭线程池</span></span>
<span class="line">        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常见线程池类型" tabindex="-1"><a class="header-anchor" href="#常见线程池类型"><span>常见线程池类型</span></a></h3><table><thead><tr><th style="text-align:left;">线程池</th><th style="text-align:left;">特点</th><th style="text-align:left;">队列</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;">可重用固定线程数的线程池<br><code>FixedThreadPool</code></td><td style="text-align:left;">核心线程数=最大线程数</td><td style="text-align:left;">LinkedBlockingQueue</td><td style="text-align:left;">已知并发量的场景</td></tr><tr><td style="text-align:left;"><code>SingleThreadExecutor</code></td><td style="text-align:left;">单线程执行，确保任务按顺序执行</td><td style="text-align:left;">无界队列LinkedBlockingQueue</td><td style="text-align:left;">需要顺序执行任务的场景</td></tr><tr><td style="text-align:left;"><code>CachedThreadPool</code></td><td style="text-align:left;">corePoolSize=0<br>maximumPoolSize=Integer.MAX_VALUE<br>按需创建线程，可缓存</td><td style="text-align:left;"></td><td style="text-align:left;">短期、异步任务</td></tr><tr><td style="text-align:left;"><code>ScheduledThreadPoolExecutor</code></td><td style="text-align:left;">支持定时和周期性任务</td><td style="text-align:left;">DelayQueue<br>执行所需事件短的先被执行</td><td style="text-align:left;">定时任务、周期性任务</td></tr><tr><td style="text-align:left;"><code>WorkStealingPool</code></td><td style="text-align:left;">基于Fork/Join框架，支持工作窃取</td><td style="text-align:left;"></td><td style="text-align:left;">递归任务、分治算法</td></tr></tbody></table><h3 id="线程池的使用步骤" tabindex="-1"><a class="header-anchor" href="#线程池的使用步骤"><span>线程池的使用步骤</span></a></h3><ol><li><strong>定义任务</strong>：实现<code>Runnable</code>或<code>Callable</code>接口</li><li><strong>创建线程池</strong>：使用<code>ThreadPoolExecutor</code>构造函数</li><li><strong>提交任务</strong>：使用<code>execute</code>或<code>submit</code>方法</li><li><strong>处理结果</strong>：对于<code>Callable</code>任务，通过<code>Future</code>获取结果</li><li><strong>关闭线程池</strong>：使用<code>shutdown</code>或<code>shutdownNow</code>方法</li></ol><h3 id="线程池使用的最佳实践" tabindex="-1"><a class="header-anchor" href="#线程池使用的最佳实践"><span>线程池使用的最佳实践</span></a></h3><ol><li><strong>明确线程池参数</strong>：根据任务类型和系统资源合理配置线程池参数</li><li><strong>使用有界队列</strong>：避免无界队列导致的内存溢出风险</li><li><strong>自定义线程工厂</strong>：设置有意义的线程名称，便于调试</li><li><strong>处理异常</strong>：确保线程池中的异常不会被忽略</li><li><strong>优雅关闭线程池</strong>：在应用程序关闭时调用<code>shutdown</code>方法</li><li><strong>监控线程池</strong>：定期检查线程池状态，避免资源泄漏</li><li><strong>避免过度使用线程池</strong>：对于短时间任务，线程池的开销可能超过其带来的好处</li><li><strong>分离不同类型的任务</strong>：对于CPU密集型和IO密集型任务，使用不同的线程池</li></ol><h2 id="工具类" tabindex="-1"><a class="header-anchor" href="#工具类"><span>工具类</span></a></h2><h3 id="executors" tabindex="-1"><a class="header-anchor" href="#executors"><span>Executors</span></a></h3><h4 id="创建线程池" tabindex="-1"><a class="header-anchor" href="#创建线程池"><span>创建线程池</span></a></h4><div class="hint-container warning"><p class="hint-container-title">注意</p><p>线程池不允许使用Executors去创建，而是通过ThreadPoolExecutor构造函数的方式。 Executors返回线程池对象的弊端：</p><ul><li>FixedThreadPool和SingleThreadExecutor允许请求队列的长度为Integer.MAX_VALUE</li><li>CacheThreadPool和ScheduledThreadPool允许创建的线程数量为Integer.MAX_VALUE</li></ul></div><ul><li>newFixedThreadPool(5); 创建固定大小的线程池</li><li>newSingleThreadExecutor(); 创建单线程池</li><li>newCachedThreadPool();创建缓存线程池</li><li>newScheduledThreadPool(3); 创建定时线程池</li><li>newWorkStealingPool()</li><li>newSingleThreadScheduledExecutor()</li></ul><h4 id="任务转换" tabindex="-1"><a class="header-anchor" href="#任务转换"><span>任务转换</span></a></h4><h3 id="executorcompletionservice" tabindex="-1"><a class="header-anchor" href="#executorcompletionservice"><span>ExecutorCompletionService</span></a></h3><p>ExecutorCompletionService是帮助获取多个Future执行结果的工具类。</p><h2 id="高级并发工具" tabindex="-1"><a class="header-anchor" href="#高级并发工具"><span>高级并发工具</span></a></h2><p>Java还提供了许多其他多线程工具，如<code>CountDownLatch</code>、<code>CyclicBarrier</code>、<code>Semaphore</code>和<code>CompletableFuture</code>等，用于处理更复杂的并发场景。</p><ul><li><code>CountDownLatch</code> 用于等待一组线程完成。 <ul><li>例如，将一个大型任务拆分为多个子任务，使用多个线程并行执行，主线程等待所有子任务完成后再汇总结果。</li></ul></li><li><code>CyclicBarrier</code> 用于让一组线程相互等待，直到所有线程都到达某个屏障点（barrier point）后再继续执行。 <ul><li>它的核心思想是通过屏障点控制线程的同步，支持重复使用和可选的屏障操作。</li><li>例如，将一个任务分为多个阶段，每个阶段需要所有线程都完成后才能进入下一阶段。</li></ul></li><li><code>Semaphore</code> 用于控制对共享资源的并发访问。 <ul><li>它的核心思想是通过许可证限制线程数量，支持公平性和非公平性模式。</li><li>常用于实现资源池、限流等功能。</li></ul></li><li><code>CompletableFuture</code> 是 Java 8 引入的一个用于异步编程的类，它提供了更强大的功能和更方便的使用方式。</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><ul><li><code>CyclicBarrier</code> 与 <code>CountDownLatch</code> 相比，<code>CyclicBarrier</code> 可以重复使用，因此适用于需要多次同步的场景。</li><li>与锁相比，<code>Semaphore</code> 更适合需要控制并发数量的场景。</li></ul></div><h3 id="countdownlatch" tabindex="-1"><a class="header-anchor" href="#countdownlatch"><span>CountDownLatch</span></a></h3><p>用于等待一组线程完成。</p><h4 id="实现原理" tabindex="-1"><a class="header-anchor" href="#实现原理"><span>实现原理</span></a></h4><ul><li><code>CountDownLatch</code> 内部维护一个计数器，初始化时需要指定一个正整数（<code>count</code>）。</li><li>每次调用 <code>countDown()</code> 方法时，计数器减 1。</li><li>当计数器减到 0 时，所有等待的线程（调用 <code>await()</code> 的线程）会被唤醒，继续执行。</li><li>一旦计数器减到 0，<code>CountDownLatch</code> 就不能再重置或重复使用。</li></ul><h4 id="主要方法" tabindex="-1"><a class="header-anchor" href="#主要方法"><span>主要方法</span></a></h4><ul><li><code>CountDownLatch(int count)</code><ul><li>构造函数，初始化计数器。</li></ul></li><li><code>void await()</code><ul><li>使当前线程等待，直到计数器减到 0。如果计数器已经是 0，则立即返回。</li></ul></li><li><code>boolean await(long timeout, TimeUnit unit)</code><ul><li>使当前线程等待，直到计数器减到 0 或超时。返回 <code>true</code> 表示计数器减到 0，<code>false</code> 表示超时。</li></ul></li><li><code>void countDown()</code><ul><li>将计数器减 1。如果计数器减到 0，则唤醒所有等待的线程。</li></ul></li><li><code>long getCount()</code><ul><li>返回当前计数器的值。</li></ul></li></ul><h4 id="代码示例-1" tabindex="-1"><a class="header-anchor" href="#代码示例-1"><span>代码示例</span></a></h4><p>以下是一个简单的示例，演示如何使用 <code>CountDownLatch</code> 实现主线程等待多个子线程完成任务：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> threadCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadCount<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; is working...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟任务执行</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has finished.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计数器减 1</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 主线程等待所有子线程完成任务</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;All threads have finished. Main thread continues.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#cyclicbarrier"><span>CyclicBarrier</span></a></h3><p>用于让一组线程相互等待，直到所有线程都到达某个屏障点（barrier point）后再继续执行。</p><h4 id="实现原理-1" tabindex="-1"><a class="header-anchor" href="#实现原理-1"><span>实现原理</span></a></h4><ul><li>所有线程必须等待其他线程都到达屏障点后才能继续执行。</li><li>当最后线程到达屏障点时，可以执行一个可选的屏障操作（<code>Runnable</code>），然后所有线程继续执行。</li><li><code>CyclicBarrier</code> 的计数器可以重置，因此可以多次使用。</li><li>调用 <code>await()</code> 的线程会被阻塞，直到所有线程都调用了 <code>await()</code>。</li></ul><h4 id="主要方法-1" tabindex="-1"><a class="header-anchor" href="#主要方法-1"><span>主要方法</span></a></h4><ul><li><code>CyclicBarrier(int parties)</code><ul><li>构造函数，指定需要等待的线程数（<code>parties</code>）。</li></ul></li><li><code>CyclicBarrier(int parties, Runnable barrierAction)</code><ul><li>构造函数，指定需要等待的线程数和一个屏障操作（<code>barrierAction</code>）。</li><li>最后一个到达屏障点的线程会执行 <code>barrierAction</code>。</li></ul></li><li><code>int await()</code><ul><li>使当前线程等待，直到所有线程都调用了 <code>await()</code>。</li><li>返回当前线程的到达索引（从 0 开始）。</li></ul></li><li><code>int await(long timeout, TimeUnit unit)</code><ul><li>使当前线程等待，直到所有线程都调用了 <code>await()</code> 或超时。</li><li>如果超时，会抛出 <code>TimeoutException</code>。</li></ul></li><li><code>int getParties()</code><ul><li>返回需要等待的线程数。</li></ul></li><li><code>int getNumberWaiting()</code><ul><li>返回当前正在等待的线程数。</li></ul></li><li><code>boolean isBroken()</code><ul><li>判断屏障是否被破坏（例如，某个线程被中断或超时）。</li></ul></li><li><code>void reset()</code><ul><li>重置屏障，使其可以重新使用。如果屏障被破坏，可以调用该方法。</li></ul></li></ul><h4 id="代码示例-2" tabindex="-1"><a class="header-anchor" href="#代码示例-2"><span>代码示例</span></a></h4><p>以下是一个简单的示例，演示如何使用 <code>CyclicBarrier</code> 实现多线程分阶段执行：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> threadCount <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span>threadCount<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;All threads have reached the barrier. Proceeding to the next phase.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; is working on phase 1.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟任务执行</span></span>
<span class="line">                    barrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待其他线程</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; is working on phase 2.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟任务执行</span></span>
<span class="line">                    barrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待其他线程</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has finished.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="semaphore" tabindex="-1"><a class="header-anchor" href="#semaphore"><span>Semaphore</span></a></h3><p><code>Semaphore</code> 用于控制对共享资源的访问。它通过维护一组许可证（permits）来限制同时访问资源的线程数量，常用于以下场景：</p><ul><li>资源池：例如，数据库连接池、线程池等，限制同时访问资源的线程数量。</li><li>限流：例如，限制同时处理的请求数量，防止系统过载。</li><li>生产者-消费者模型：使用 <code>Semaphore</code> 控制生产者和消费者的并发数量。</li></ul><h4 id="实现原理-2" tabindex="-1"><a class="header-anchor" href="#实现原理-2"><span>实现原理</span></a></h4><ul><li><code>Semaphore</code> 内部维护一个许可证计数器，初始化时可以指定许可证的数量。</li><li>线程访问资源前需要获取许可证（调用 <code>acquire()</code>）</li><li>访问完成后释放许可证（调用 <code>release()</code>）</li><li>如果许可证数量为 0，线程会被阻塞，直到有其他线程释放许可证。</li><li><code>Semaphore</code> 支持公平模式和非公平模式。 <ul><li>在公平模式下，线程按照请求许可证的顺序获取许可证。</li><li>在非公平模式下，线程可能会插队获取许可证。</li></ul></li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li>确保线程在使用完资源后释放许可证，否则可能导致其他线程无法访问资源。</li><li>如果线程在获取许可证后发生异常，确保在 <code>finally</code> 块中释放许可证。</li></ul></div><h4 id="主要方法-2" tabindex="-1"><a class="header-anchor" href="#主要方法-2"><span>主要方法</span></a></h4><ul><li><code>Semaphore(int permits)</code>： <ul><li>构造函数，指定许可证的数量。</li></ul></li><li><code>Semaphore(int permits, boolean fair)</code>： <ul><li>构造函数，指定许可证的数量和公平性（<code>true</code> 表示公平模式，<code>false</code> 表示非公平模式）。</li></ul></li><li><code>void acquire()</code>： <ul><li>获取一个许可证，如果没有可用的许可证，则当前线程会被阻塞，直到获取到许可证。</li></ul></li><li><code>void acquire(int permits)</code>： <ul><li>获取指定数量的许可证。</li></ul></li><li><code>void release()</code>： <ul><li>释放一个许可证。</li></ul></li><li><code>void release(int permits)</code>： <ul><li>释放指定数量的许可证。</li></ul></li><li><code>boolean tryAcquire()</code>： <ul><li>尝试获取一个许可证，如果成功则返回 <code>true</code>，否则返回 <code>false</code>。</li></ul></li><li><code>boolean tryAcquire(long timeout, TimeUnit unit)</code>： <ul><li>在指定时间内尝试获取一个许可证，如果成功则返回 <code>true</code>，否则返回 <code>false</code>。</li></ul></li><li><code>int availablePermits()</code>： <ul><li>返回当前可用的许可证数量。</li></ul></li><li><code>boolean isFair()</code>： <ul><li>判断 <code>Semaphore</code> 是否是公平模式。</li></ul></li><li><code>void drainPermits()</code>： <ul><li>获取并返回所有可用的许可证。</li></ul></li></ul><h4 id="代码示例-3" tabindex="-1"><a class="header-anchor" href="#代码示例-3"><span>代码示例</span></a></h4><p>以下是一个简单的示例，演示如何使用 <code>Semaphore</code> 实现资源池：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> poolSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span>poolSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取许可证</span></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; is using the resource.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟资源使用</span></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has finished using the resource.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放许可证</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="completablefuture" tabindex="-1"><a class="header-anchor" href="#completablefuture"><span>CompletableFuture</span></a></h3><p><code>CompletableFuture</code> 是 Java 8 引入的一个强大的并发编程工具，它实现了 <code>CompletionStage</code> 接口和 <code>Future</code> 接口，并提供了更丰富的功能来处理异步任务。与传统的 <code>Future</code> 相比，<code>CompletableFuture</code> 支持任务结果的依赖、组合、异常处理等高级特性，使得异步编程更加灵活和高效。</p><p>CompletableFuture 默认使用 <code>ForkJoinPool.commonPool()</code> 线程池执行任务，也可以指定自定义线程池。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p><code>CompletableFuture</code> 是 <code>Future</code> 的增强版，它不仅表示异步计算的结果，还提供了丰富的 API 来处理异步任务的执行过程，如任务依赖、组合和异常处理等。</p></div><h4 id="核心特性" tabindex="-1"><a class="header-anchor" href="#核心特性"><span>核心特性</span></a></h4><ul><li>异步任务执行：支持任务的异步执行，并可以在任务完成后触发回调。</li><li>任务依赖：可以将多个任务串联起来，形成任务链。</li><li>任务组合：支持将多个任务的结果组合起来。</li><li>异常处理：提供了异常处理的机制。</li><li>手动完成任务：可以手动设置任务的结果或异常。</li></ul><h4 id="创建异步任务" tabindex="-1"><a class="header-anchor" href="#创建异步任务"><span>创建异步任务</span></a></h4><p>CompletableFuture创建异步任务，一般有supplyAsync和runAsync两个方法</p><p><img src="https://cdn.nlark.com/yuque/0/2024/webp/21987629/1715564492359-1d339f24-de57-4821-9381-a7e6d598c34c.webp" alt=""></p><ul><li>supplyAsync执行CompletableFuture任务，支持返回值</li><li>runAsync执行CompletableFuture任务，没有返回值。</li></ul><h5 id="supplyasync" tabindex="-1"><a class="header-anchor" href="#supplyasync"><span>supplyAsync</span></a></h5><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">//使用默认内置线程池ForkJoinPool.commonPool()，根据supplier构建执行任务</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//自定义线程，根据supplier构建执行任务</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟任务执行</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token string">&quot;Task Result&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 获取任务结果</span></span>
<span class="line">        <span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="runasync方法" tabindex="-1"><a class="header-anchor" href="#runasync方法"><span>runAsync方法</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">//使用默认内置线程池ForkJoinPool.commonPool()，根据runnable构建执行任务</span>
<span class="line"></span>
<span class="line">public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable) </span>
<span class="line"></span>
<span class="line">//自定义线程，根据runnable构建执行任务</span>
<span class="line"></span>
<span class="line">public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,  Executor executor)</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟任务执行</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Task Executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        future<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待任务完成</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="任务依赖与组合" tabindex="-1"><a class="header-anchor" href="#任务依赖与组合"><span>任务依赖与组合</span></a></h4><p><img src="https://cdn.nlark.com/yuque/0/2025/jpeg/21987629/1738822955998-5c8cbc2c-40b8-4ef7-8d0e-b677ebddcefe.jpeg" alt="画板"></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">simulateTask</span><span class="token punctuation">(</span><span class="token string">&quot;查询数据库&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;查询结果&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">future<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 对结果进行处理</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;处理后的结果：&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>processedResult <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 消费处理后的结果</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;最终结果：&quot;</span> <span class="token operator">+</span> processedResult<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 执行一些不需要前一个结果的操作</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;所有操作完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用注意事项" tabindex="-1"><a class="header-anchor" href="#使用注意事项"><span>使用注意事项</span></a></h4><p>CompletableFuture 使我们的异步编程更加便利的、代码更加优雅的同时，我们也要关注下它，使用的一些注意点。</p><p><img src="https://cdn.nlark.com/yuque/0/2024/webp/21987629/1715565574455-e6029c3d-4ae3-489c-ab79-4e6d991354a4.webp" alt=""></p><h5 id="默认线程池的注意点" tabindex="-1"><a class="header-anchor" href="#默认线程池的注意点"><span>默认线程池的注意点</span></a></h5><p>CompletableFuture代码中又使用了默认的线程池，处理的线程个数是电脑CPU核数-1。在大量请求过来的时候，处理逻辑复杂的话，响应会很慢。一般建议使用自定义线程池，优化线程池配置参数。</p><h5 id="自定义线程池时-注意饱和策略" tabindex="-1"><a class="header-anchor" href="#自定义线程池时-注意饱和策略"><span>自定义线程池时，注意饱和策略</span></a></h5><p>CompletableFuture的get()方法是阻塞的，我们一般建议使用future.get(3, TimeUnit.SECONDS)。并且一般建议使用自定义线程池。</p><p>但是如果线程池拒绝策略是DiscardPolicy或者DiscardOldestPolicy，当线程池饱和时，会直接丢弃任务，不会抛弃异常。因此建议，CompletableFuture线程池策略最好使用AbortPolicy，然后耗时的异步线程，做好线程池隔离哈。</p><h4 id="代码示例-4" tabindex="-1"><a class="header-anchor" href="#代码示例-4"><span>代码示例</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code><span class="line"><span class="token comment">//异步</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">HttpRequest</span> httpRequest <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token constant">URI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringBodyHandler <span class="token operator">=</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandlers</span><span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpResponse</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sendAsync <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span> stringBodyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">HttpResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> rep <span class="token operator">=</span> sendAsync<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> body <span class="token operator">=</span> rep<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springboot中的线程池" tabindex="-1"><a class="header-anchor" href="#springboot中的线程池"><span>SpringBoot中的线程池</span></a></h2><p>SpringBoot中的线程池：ThreadPoolTaskExecutor</p><p>:::tips Spring 通过任务执行器（TaskExecutor）来实现多线程和并发编程，该接口与juc的 Executor 接口完全相同。<br> SpringBoot中的线程池ThreadPoolTaskExecutor对应juc的ThreadPoolExecutor。 :::</p><h2 id="常见对比" tabindex="-1"><a class="header-anchor" href="#常见对比"><span>常见对比</span></a></h2><h3 id="countdownlatch-vs-cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#countdownlatch-vs-cyclicbarrier"><span>CountDownLatch VS CyclicBarrier</span></a></h3><table><thead><tr><th>特性</th><th>CountDownLatch</th><th>CyclicBarrier</th></tr></thead><tbody><tr><td>计数器重置</td><td>不可重置</td><td>可重置</td></tr><tr><td>使用场景</td><td>一个线程等待多个线程完成任务</td><td>多个线程相互等待</td></tr><tr><td>调用方法</td><td><code>countDown()</code> 和 <code>await()</code></td><td><code>await()</code></td></tr><tr><td>重复使用</td><td>不支持</td><td>支持</td></tr></tbody></table><h3 id="semaphore-vs-锁" tabindex="-1"><a class="header-anchor" href="#semaphore-vs-锁"><span>Semaphore VS 锁</span></a></h3><table><thead><tr><th>特性</th><th>Semaphore</th><th>锁（如 ReentrantLock）</th></tr></thead><tbody><tr><td>控制方式</td><td>控制访问资源的线程数量</td><td>控制对共享资源的独占访问</td></tr><tr><td>许可证数量</td><td>可以设置多个许可证</td><td>只有一个锁</td></tr><tr><td>公平性</td><td>支持公平和非公平模式</td><td>支持公平和非公平模式</td></tr><tr><td>适用场景</td><td>资源池、限流等</td><td>临界区保护</td></tr></tbody></table><h3 id="runnable-vs-callable" tabindex="-1"><a class="header-anchor" href="#runnable-vs-callable"><span>Runnable vs Callable</span></a></h3><table><thead><tr><th></th><th>Runnable</th><th>Callable</th></tr></thead><tbody><tr><td>JAVA</td><td>1.0</td><td>1.5</td></tr><tr><td>返回结果</td><td>×</td><td>√</td></tr><tr><td>检查异常</td><td>×</td><td>√</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>工具类Executors可以实现两者的相互转换</p><h3 id="completablefuture-vs-executorservice" tabindex="-1"><a class="header-anchor" href="#completablefuture-vs-executorservice"><span>CompletableFuture vs ExecutorService</span></a></h3><table><thead><tr><th></th><th>CompletableFuture</th><th>ExecutorService</th></tr></thead><tbody><tr><td>有返回值</td><td>supplyAsync</td><td>submit</td></tr><tr><td>无返回值</td><td>runAsync</td><td>execute</td></tr></tbody></table><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2><p>线程池不允许使用Executors去创建，而是通过ThreadPoolExecutor构造函数的方式</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2025-08-08T08:47:47.000Z" data-allow-mismatch>2025/8/8 08:47</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 3036190149@qq.com">zhaomy</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-ty-Ai2oG.js" defer></script>
  </body>
</html>
